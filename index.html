<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CRM AI â€¢ PRO Demo (Level 7)</title>
<style>
:root{
  --bg:#ffffff;
  --bg2:#f7f8fb;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --line:#e5e7eb;

  --blue:#579bfc;
  --purple:#a855f7;
  --green:#22c55e;
  --amber:#f59e0b;
  --red:#ef4444;
  --teal:#14b8a6;
  --pink:#fb7185;
  --indigo:#6366f1;

  --shadow:0 10px 30px rgba(17,24,39,.08);
  --shadow2:0 18px 60px rgba(2,6,23,.16);
  --r14:14px;
  --r18:18px;
  --r22:22px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Arial;
  color:var(--text);
  background:linear-gradient(180deg, var(--bg), var(--bg2));
}
a{color:inherit}

@keyframes in{
  from{opacity:0;transform:translateY(8px)}
  to{opacity:1;transform:translateY(0)}
}
@keyframes pop{
  from{transform:translateY(10px);opacity:0}
  to{transform:translateY(0);opacity:1}
}
@keyframes glow{
  0%,100%{box-shadow:0 0 0 0 rgba(87,155,252,.16)}
  50%{box-shadow:0 0 0 10px rgba(87,155,252,0)}
}

.shell{display:flex;min-height:100vh;}

/* Right rail (navigation) */
.rail{
  width:320px;
  background:rgba(255,255,255,.92);
  border-left:1px solid var(--line);
  position:sticky;top:0;height:100vh;overflow:auto;
  padding:14px 12px;
  backdrop-filter:blur(10px);
}
.brand{display:flex;align-items:center;gap:10px;padding:10px;border-radius:var(--r18);}
.logo{
  width:42px;height:42px;border-radius:16px;
  background:linear-gradient(135deg,var(--purple),var(--blue));
  box-shadow:0 18px 40px rgba(87,155,252,.22);
  position:relative;
}
.logo:after{content:"";position:absolute;inset:2px;border-radius:14px;background:linear-gradient(135deg,rgba(255,255,255,.35),rgba(255,255,255,0));}
.brandTitle{font-weight:950;font-size:14px;}
.brandSub{font-size:12px;color:var(--muted);font-weight:800;}

.section{margin-top:12px;padding:10px;border-radius:var(--r18);border:1px solid var(--line);background:#fff;box-shadow:0 10px 22px rgba(2,6,23,.06);animation:in .2s ease-out;}
.sectionHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;}
.sectionHead .t{font-weight:950;}
.sectionHead .s{font-size:12px;color:var(--muted);font-weight:800;}

.btn{
  padding:10px 12px;border-radius:var(--r14);
  border:1px solid var(--line);background:#fff;
  font-weight:950;cursor:pointer;transition:.15s ease;
  display:inline-flex;align-items:center;gap:8px;user-select:none;
}
.btn:hover{transform:translateY(-1px);box-shadow:0 12px 26px rgba(2,6,23,.08);}
.btn:active{transform:translateY(0);}
.btn.primary{background:var(--blue);color:#fff;border-color:transparent;}
.btn.purple{background:var(--purple);color:#fff;border-color:transparent;}
.btn.teal{background:var(--teal);color:#fff;border-color:transparent;}
.btn.indigo{background:var(--indigo);color:#fff;border-color:transparent;}
.btn.pink{background:var(--pink);color:#fff;border-color:transparent;}
.btn.ghost{background:transparent;}
.btn.full{width:100%;justify-content:space-between;}
.btn.icon{width:44px;justify-content:center;padding:10px;}

.badge{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:20px;padding:0 7px;border-radius:999px;font-size:12px;font-weight:950;border:1px solid var(--line);background:#fff;}
.badge.blue{background:rgba(87,155,252,.12);border-color:rgba(87,155,252,.28);color:#1d4ed8;}
.badge.purple{background:rgba(168,85,247,.12);border-color:rgba(168,85,247,.28);color:#6b21a8;}
.badge.teal{background:rgba(20,184,166,.12);border-color:rgba(20,184,166,.28);color:#0f766e;}
.badge.amber{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.28);color:#854d0e;}
.badge.red{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.28);color:#991b1b;}

.small{font-size:12px;color:var(--muted);font-weight:800;line-height:1.45;}
input,select,textarea{
  padding:10px 12px;border:1px solid var(--line);border-radius:var(--r14);
  background:#fff;font-weight:850;color:var(--text);outline:none;
}
input:focus,select:focus,textarea:focus{border-color:rgba(87,155,252,.55);box-shadow:0 0 0 3px rgba(87,155,252,.16);}
textarea{min-height:94px;resize:vertical;}
hr{border:none;border-top:1px solid var(--line);}

.navList{display:flex;flex-direction:column;gap:8px;}
.navItem{display:flex;justify-content:space-between;align-items:center;gap:10px;width:100%;}
.navItem.active{border-color:rgba(87,155,252,.55);box-shadow:0 0 0 3px rgba(87,155,252,.16);}

.boards{display:flex;flex-direction:column;gap:8px;}
.boardBtn{width:100%;justify-content:space-between;text-align:right;}
.boardBtn.active{border-color:rgba(168,85,247,.55);box-shadow:0 0 0 3px rgba(168,85,247,.16);}

/* Main area */
.main{flex:1;padding:14px 14px 28px;}
.top{
  position:sticky;top:10px;z-index:40;
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding:10px 12px;border-radius:var(--r18);
  border:1px solid var(--line);
  background:rgba(255,255,255,.92);
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  animation:in .22s ease-out;
}
.top .left,.top .right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.h1{font-size:18px;font-weight:950;margin:0;}
.subline{font-size:12px;color:var(--muted);font-weight:800;margin-top:2px;}
.pageTitle{margin:14px 2px 10px;font-size:20px;font-weight:950;animation:in .22s ease-out;}

.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;}
.card{
  background:#fff;border:1px solid var(--line);border-radius:var(--r18);
  box-shadow:0 10px 24px rgba(2,6,23,.06);
  overflow:hidden;animation:in .22s ease-out;
}
.cardHead{
  padding:10px 12px;border-bottom:1px solid var(--line);
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  background:linear-gradient(180deg,#fff,#fbfcff);
}
.cardHead .t{font-weight:950;}
.cardBody{padding:12px;}
.kpiVal{font-size:28px;font-weight:950;letter-spacing:-.3px;}
.pill{
  display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
  border:1px solid var(--line);background:#fff;font-weight:950;font-size:12px;
}
.pill.blue{background:rgba(87,155,252,.10);border-color:rgba(87,155,252,.24);color:#1d4ed8;}
.pill.purple{background:rgba(168,85,247,.10);border-color:rgba(168,85,247,.24);color:#6b21a8;}
.pill.teal{background:rgba(20,184,166,.10);border-color:rgba(20,184,166,.24);color:#0f766e;}
.pill.amber{background:rgba(245,158,11,.10);border-color:rgba(245,158,11,.24);color:#854d0e;}
.pill.red{background:rgba(239,68,68,.10);border-color:rgba(239,68,68,.24);color:#991b1b;}

.tableWrap{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff;}
table{width:100%;border-collapse:separate;border-spacing:0;}
th,td{padding:10px;text-align:right;border-bottom:1px solid var(--line);font-size:13px;}
th{background:#f3f6ff;font-weight:950;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:#fbfdff;}

.miniGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}
.spark{height:210px;border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden;}

/* Widgets canvas (dashboard builder) */
.canvas{
  position:relative;min-height:860px;
  border:1px dashed rgba(229,231,235,.9);
  border-radius:22px;background:linear-gradient(180deg,#fff,#fbfcff);
  overflow:hidden;
}
.canvasBg{
  position:absolute;inset:0;opacity:.22;pointer-events:none;
  background-image:
    linear-gradient(to right, rgba(226,232,240,.9) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(226,232,240,.9) 1px, transparent 1px);
  background-size:60px 60px;
}
.tile{
  position:absolute;border:1px solid var(--line);border-radius:18px;background:#fff;
  box-shadow:0 10px 24px rgba(2,6,23,.06);overflow:hidden;
  transition:box-shadow .15s ease;
}
.tile:hover{box-shadow:var(--shadow2);}
.tileHead{
  padding:10px 12px;border-bottom:1px solid var(--line);
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  background:linear-gradient(180deg,#fff,#fbfcff);
}
.tileHead .t{font-weight:950;display:flex;align-items:center;gap:10px;}
.dot{width:10px;height:10px;border-radius:50%;background:var(--blue);box-shadow:0 0 0 6px rgba(87,155,252,.12);}
.dragArea{cursor:grab;}
.dragging .dragArea{cursor:grabbing;}
.handle{position:absolute;left:10px;bottom:10px;width:14px;height:14px;border-radius:4px;background:rgba(107,114,128,.22);cursor:nwse-resize;}
.tileBody{padding:12px;}

/* Modals */
.modal{
  position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  padding:14px;background:rgba(2,6,23,.55);z-index:80;
}
.modal .box{
  width:min(1100px,100%);border-radius:22px;border:1px solid var(--line);
  background:#fff;box-shadow:var(--shadow2);overflow:hidden;animation:pop .18s ease-out;
}
.modal .bar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;background:#f8fafc;border-bottom:1px solid var(--line);}
.modal .bar .t{font-weight:950;}
.modal .body{padding:14px;background:linear-gradient(180deg,#fff,#fbfcff);}
.x{border:1px solid var(--line);background:#fff;border-radius:14px;padding:8px 10px;cursor:pointer;font-weight:950;}
.cols{display:grid;grid-template-columns:1.15fr .85fr;gap:12px;}
@media(max-width:980px){.cols{grid-template-columns:1fr;}}

/* Command Bar */
.cmdk{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:14px;background:rgba(2,6,23,.55);z-index:90;}
.cmdk .box{width:min(760px,100%);background:#fff;border-radius:22px;border:1px solid var(--line);box-shadow:var(--shadow2);overflow:hidden;animation:pop .18s ease-out;}
.cmdk .bar{padding:12px 14px;border-bottom:1px solid var(--line);background:#f8fafc;display:flex;gap:10px;align-items:center;}
.cmdk .list{max-height:360px;overflow:auto;padding:10px;display:flex;flex-direction:column;gap:8px;background:linear-gradient(180deg,#fff,#fbfcff);}
.cmdk .row{display:flex;justify-content:space-between;gap:10px;align-items:center;padding:10px;border:1px solid var(--line);border-radius:16px;background:#fff;cursor:pointer;}
.cmdk .row:hover{box-shadow:0 12px 26px rgba(2,6,23,.08);}
.kbd{font-size:11px;color:var(--muted);font-weight:900;border:1px solid var(--line);padding:4px 8px;border-radius:999px;background:#fff;}

/* Toasts */
.toasts{position:fixed;left:14px;bottom:14px;display:flex;flex-direction:column;gap:10px;z-index:95;}
.toast{min-width:260px;max-width:380px;background:#fff;border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow2);padding:10px 12px;animation:pop .18s ease-out;}

/* Notifications */
.bell{position:relative}
.dotNotif{position:absolute;left:2px;top:2px;width:10px;height:10px;border-radius:50%;background:var(--red);animation:glow 1.8s ease-in-out infinite;}

/* Floating ToDo */
.floatTodo{
  position:fixed;right:14px;bottom:14px;width:min(380px, calc(100vw - 28px));
  background:#fff;border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow2);
  z-index:85;overflow:hidden;transform:translateY(0);transition:transform .18s ease, opacity .18s ease;
}
.floatTodo.hidden{transform:translateY(20px);opacity:0;pointer-events:none;}
.floatTodo .hdr{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px 12px;border-bottom:1px solid var(--line);background:#fbfcff;}
.taskRow{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;padding:10px;border:1px solid var(--line);border-radius:16px;background:#fff;margin-bottom:8px;}
.taskRow:hover{box-shadow:0 12px 26px rgba(2,6,23,.08);}
.taskRow .t{font-weight:950;}
.taskRow .m{font-size:12px;color:var(--muted);font-weight:850;margin-top:4px;}

/* Mobile */
@media(max-width:980px){
  .rail{position:fixed;right:0;top:0;height:100vh;z-index:70;transform:translateX(100%);transition:transform .2s ease;width:310px;box-shadow:var(--shadow2);}
  body.nav-open .rail{transform:translateX(0);}
  .main{padding:12px;}
  .top{top:8px;}
}
</style>
</head>
<body>
<div class="shell">
  <aside class="rail">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="brandTitle">CRM AI â€¢ PRO</div>
        <div class="brandSub" id="railSub">××•×¦×¨ ×××™×ª×™ â€¢ Level 7</div>
      </div>
    </div>

    <div class="section" id="wsSection">
      <div class="sectionHead">
        <div>
          <div class="t">Workspaces</div>
          <div class="s">××¨×—×‘×™ ×¢×‘×•×“×” / ×¦×•×•×ª×™×</div>
        </div>
        <button class="btn icon" onclick="openWorkspaceModal()" title="×”×•×¡×£ Workspace">ï¼‹</button>
      </div>
      <div class="small">×‘×“××•: ×›××” Workspaces (×›××• Monday). ×‘×—×¨ ×›×“×™ ×œ×”×—×œ×™×£ ×”×§×©×¨.</div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
        <select id="workspaceSelect" onchange="switchWorkspace(this.value)" style="flex:1;min-width:190px"></select>
        <button class="btn indigo" onclick="openCmdK()">âŒ˜K</button>
      </div>
    </div>

    <div class="section">
      <div class="sectionHead">
        <div>
          <div class="t">Boards</div>
          <div class="s">×œ×•×—×•×ª ×œ×¤×™ ×¡×•×’ ×¢×¡×§</div>
        </div>
        <button class="btn icon" onclick="openBoardModal()" title="×”×•×¡×£ Board">ï¼‹</button>
      </div>
      <div class="boards" id="boardList"></div>
      <div class="small" style="margin-top:8px">×‘×“××•: â€œ××¡×¤×¨×”â€ ×–×” Board ×¤×¢×™×œ.</div>
    </div>

    <div class="section">
      <div class="sectionHead">
        <div>
          <div class="t">× ×™×•×•×˜</div>
          <div class="s">××•×“×•×œ×™×</div>
        </div>
        <span id="roleBadge" class="badge blue">Owner</span>
      </div>
      <div class="navList" id="nav"></div>
    </div>

    <div class="section">
      <div class="sectionHead">
        <div>
          <div class="t">×§×™×¦×•×¨×™×</div>
          <div class="s">AI + Builder</div>
        </div>
        <span class="badge purple">PRO</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <button class="btn pink" style="justify-content:center" onclick="openAIBuild()">AI Builder</button>
        <button class="btn teal" style="justify-content:center" onclick="openAI()">AI ×ª×•×‘× ×•×ª</button>
        <button class="btn primary" style="justify-content:center" onclick="openWidgetBuilder()">Add Widget</button>
        <button class="btn" style="justify-content:center" onclick="toggleFloatTodo()">Toâ€‘Do ×¦×£</button>
      </div>
      <div class="small" style="margin-top:10px">×©×›×‘×ª â€œBuilderâ€ ××œ××” + ××•×˜×•××¦×™×•×ª + × ×•×˜×™×¤×™×§×¦×™×•×ª.</div>
    </div>
  </aside>

  <main class="main">
    <div class="top">
      <div class="right">
        <button class="btn icon" onclick="toggleNav()">â˜°</button>
        <div>
          <div class="h1" id="tenantTitle">×”××¡×¤×¨×” ×©×œ ××™×¦×™×§</div>
          <div class="subline" id="contextLine">×“×©×‘×•×¨×“ â€¢ Builder â€¢ AI â€¢ ×ª×•×¨×™× â€¢ ××¡××›×™×</div>
        </div>
      </div>
      <div class="left">
        <span class="small">××ª××¨×™×š</span>
        <input id="fromDate" type="date" value="2026-02-01"/>
        <span class="small">×¢×“</span>
        <input id="toDate" type="date" value="2026-02-12"/>
        <button class="btn primary" onclick="applyRange()">×”×¦×’</button>
        <button class="btn" onclick="toggleCompare()">×”×©×•×•××”</button>
        <button class="btn icon bell" onclick="openNotifications()" title="×”×ª×¨××•×ª">
          ğŸ””<span id="notifDot" class="dotNotif" style="display:none"></span>
        </button>
        <input id="globalSearch" placeholder="×—×™×¤×•×© ×—×•×¤×©×™ (×“××•)" oninput="render()" style="min-width:180px"/>
        <button class="btn indigo" onclick="openCmdK()">âŒ˜K</button>
        <button class="btn" onclick="openSettings()">×”×’×“×¨×•×ª</button>
      </div>
    </div>

    <div class="pageTitle" id="pageTitle">×“×©×‘×•×¨×“</div>
    <div id="page"></div>
  </main>
</div>

<!-- Floating To-Do -->
<div id="floatTodo" class="floatTodo">
  <div class="hdr">
    <div style="display:flex;align-items:center;gap:10px;font-weight:950">
      <span class="dot" style="background:var(--amber)"></span>Toâ€‘Do ×¦×£
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn ghost" onclick="quickCreateTask()">+ ××©×™××”</button>
      <button class="x" onclick="toggleFloatTodo(true)">×¡×’×•×¨</button>
    </div>
  </div>
  <div style="padding:10px 12px;max-height:320px;overflow:auto" id="floatTodoBody"></div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="box">
    <div class="bar">
      <div class="t" id="mTitle"></div>
      <button class="x" onclick="closeModal()">×¡×’×•×¨</button>
    </div>
    <div class="body" id="mBody"></div>
  </div>
</div>

<!-- Command Bar -->
<div class="cmdk" id="cmdk">
  <div class="box">
    <div class="bar">
      <input id="cmdkInput" placeholder="×—×¤×© ×¤×§×•×“×” / ×œ×§×•×— / ××¡××š / ×ª×•×¨â€¦ (×“××•)" style="width:100%"/>
      <button class="x" onclick="closeCmdK()">×¡×’×•×¨</button>
    </div>
    <div class="list" id="cmdkList"></div>
  </div>
</div>

<!-- Toasts -->
<div class="toasts" id="toasts"></div>

<script>
/* ===================== DATA ===================== */
const demo = {
  tenants: [
    {id:1, name:"×”××¡×¤×¨×” ×©×œ ××™×¦×™×§", type:"××¡×¤×¨×”"},
    {id:2, name:"××•×¡×š ××œ×¤×", type:"××•×¡×š"},
    {id:3, name:"×¡×˜×•×“×™×• ×™×•×’×” × ×•×¢×”", type:"×¡×˜×•×“×™×•"},
  ],
  users: [
    {id:1, name:"××™×¦×™×§", role:"Owner"},
    {id:2, name:"××™×›×œ", role:"Manager"},
    {id:3, name:"×“× ×™", role:"Employee"},
    {id:4, name:"×œ×™×¨×•×Ÿ", role:"Employee"},
  ],
  customers: [{"id": 1000, "no": 101, "name": "×©× ×™ ××–×¨×—×™", "phone": "056-1810111", "email": "×©× ×™××–×¨×—×™10@mail.com", "address": "×—×™×¤×”, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 75", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Walk-in"}, {"id": 1001, "no": 102, "name": "××•×¨ ×›×”×Ÿ", "phone": "051-8275367", "email": "××•×¨×›×”×Ÿ54@mail.com", "address": "×—×™×¤×”, ×¨×—×³ ×”×¨×¦×œ 12", "note": "", "source": "×”××œ×¦×”"}, {"id": 1002, "no": 103, "name": "× ×•×¢×” ×—×“×“", "phone": "051-4745328", "email": "× ×•×¢×”×—×“×“81@mail.com", "address": "×ª×œ ××‘×™×‘, ×¨×—×³ ×”×™× 75", "note": "VIP", "source": "Google"}, {"id": 1003, "no": 104, "name": "×¨×•×¢×™ ×›×”×Ÿ", "phone": "058-3234302", "email": "×¨×•×¢×™×›×”×Ÿ38@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×”×¨×¦×œ 70", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Walk-in"}, {"id": 1004, "no": 105, "name": "×œ×™××•×¨ ×“×•×™×“", "phone": "052-2728987", "email": "×œ×™××•×¨×“×•×™×“75@mail.com", "address": "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 13", "note": "", "source": "Google"}, {"id": 1005, "no": 106, "name": "× ×•×¢×” ×—×“×“", "phone": "053-9328453", "email": "× ×•×¢×”×—×“×“88@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 60", "note": "", "source": "×”××œ×¦×”"}, {"id": 1006, "no": 107, "name": "×˜×œ ×™×©×¨××œ×™", "phone": "053-4015985", "email": "×˜×œ×™×©×¨××œ×™90@mail.com", "address": "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, ×¨×—×³ ×”×¢×¦×××•×ª 74", "note": "××¢×“×™×£ ×‘×•×§×¨", "source": "Walk-in"}, {"id": 1007, "no": 108, "name": "×©×§×“ ××‘×¨×”×", "phone": "057-5830794", "email": "×©×§×“××‘×¨×”×78@mail.com", "address": "×—×™×¤×”, ×¨×—×³ ×”×¢×¦×××•×ª 66", "note": "VIP", "source": "Meta"}, {"id": 1008, "no": 109, "name": "×©× ×™ ××–×¨×—×™", "phone": "057-8074924", "email": "×©× ×™××–×¨×—×™6@mail.com", "address": "×—×™×¤×”, ×¨×—×³ ×”×™× 74", "note": "××¢×“×™×£ ×‘×•×§×¨", "source": "××•×¨×’× ×™"}, {"id": 1009, "no": 110, "name": "×˜×œ ×—×“×“", "phone": "057-8653855", "email": "×˜×œ×—×“×“9@mail.com", "address": "×—×™×¤×”, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 61", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Google"}, {"id": 1010, "no": 111, "name": "×œ×™××•×¨ ×©×—×¨", "phone": "059-8476611", "email": "×œ×™××•×¨×©×—×¨37@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 3", "note": "VIP", "source": "××•×¨×’× ×™"}, {"id": 1011, "no": 112, "name": "×××™×” ×—×“×“", "phone": "051-9282794", "email": "×××™×”×—×“×“8@mail.com", "address": "×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 17", "note": "×¨×’×™×© ×œ×¢×•×¨", "source": "×”××œ×¦×”"}, {"id": 1012, "no": 113, "name": "××œ×•×Ÿ ×¨×•×–×Ÿ", "phone": "051-3791163", "email": "××œ×•×Ÿ×¨×•×–×Ÿ58@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×”×™× 36", "note": "×¨×’×™×© ×œ×¢×•×¨", "source": "×”××œ×¦×”"}, {"id": 1013, "no": 114, "name": "×¢×“×™ ×§×“×", "phone": "056-7019181", "email": "×¢×“×™×§×“×88@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×”×¨×¦×œ 20", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Meta"}, {"id": 1014, "no": 115, "name": "××™×ª×™ ×¤×¨×¥", "phone": "053-1202384", "email": "××™×ª×™×¤×¨×¥63@mail.com", "address": "×™×¨×•×©×œ×™×, ×¨×—×³ ×‘×Ÿ ×’×•×¨×™×•×Ÿ 37", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Meta"}, {"id": 1015, "no": 116, "name": "×“× ×” ×“×•×™×“", "phone": "055-6345416", "email": "×“× ×”×“×•×™×“17@mail.com", "address": "×ª×œ ××‘×™×‘, ×¨×—×³ ×”× ×‘×™××™× 116", "note": "", "source": "×”××œ×¦×”"}, {"id": 1016, "no": 117, "name": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "phone": "056-2737064", "email": "××œ×•×Ÿ×‘×™×˜×•×Ÿ62@mail.com", "address": "× ×ª× ×™×”, ×¨×—×³ ×”×¢×¦×××•×ª 25", "note": "×œ×§×•×— ×§×‘×•×¢", "source": "Meta"}, {"id": 1017, "no": 118, "name": "×¢×•××¨ ××–×¨×—×™", "phone": "051-6705153", "email": "×¢×•××¨××–×¨×—×™77@mail.com", "address": "×ª×œ ××‘×™×‘, ×¨×—×³ ×”×¢×¦×××•×ª 1", "note": "", "source": "Meta"}],
  docs: [{"id": 2000, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 550, "customerNo": 118, "customerName": "×¢×•××¨ ××–×¨×—×™", "status": "××•×©×¨×”", "total": 80, "paidAmount": 0, "createdDate": "2026-02-10", "approvedDate": "2026-02-10", "paidDate": "", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2001, "kind": "×—×©×‘×•× ×™×ª", "no": 551, "customerNo": 113, "customerName": "××œ×•×Ÿ ×¨×•×–×Ÿ", "status": "×©×•×œ××”", "total": 120, "paidAmount": 120, "createdDate": "2026-02-06", "approvedDate": "", "paidDate": "2026-02-10", "performer": "×œ×™×¨×•×Ÿ", "source": "×”××œ×¦×”"}, {"id": 2002, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 552, "customerNo": 104, "customerName": "×¨×•×¢×™ ×›×”×Ÿ", "status": "××•×©×¨×”", "total": 150, "paidAmount": 0, "createdDate": "2026-02-08", "approvedDate": "2026-02-11", "paidDate": "", "performer": "×“× ×™", "source": "Walk-in"}, {"id": 2003, "kind": "×—×©×‘×•× ×™×ª", "no": 553, "customerNo": 103, "customerName": "× ×•×¢×” ×—×“×“", "status": "×¤×ª×•×—×”", "total": 120, "paidAmount": 0, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "", "performer": "×“× ×™", "source": "Google"}, {"id": 2004, "kind": "×—×©×‘×•× ×™×ª", "no": 554, "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "status": "×‘××™×—×•×¨", "total": 100, "paidAmount": 0, "createdDate": "2026-02-01", "approvedDate": "", "paidDate": "", "performer": "×“× ×™", "source": "×”××œ×¦×”"}, {"id": 2005, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 555, "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "status": "×‘×•×˜×œ×”", "total": 250, "paidAmount": 0, "createdDate": "2026-02-05", "approvedDate": "", "paidDate": "", "performer": "××™×¦×™×§", "source": "Google"}, {"id": 2006, "kind": "×—×©×‘×•× ×™×ª", "no": 556, "customerNo": 109, "customerName": "×©× ×™ ××–×¨×—×™", "status": "×©×•×œ××”", "total": 200, "paidAmount": 200, "createdDate": "2026-02-06", "approvedDate": "", "paidDate": "2026-02-07", "performer": "×“× ×™", "source": "××•×¨×’× ×™"}, {"id": 2007, "kind": "×—×©×‘×•× ×™×ª", "no": 557, "customerNo": 108, "customerName": "×©×§×“ ××‘×¨×”×", "status": "×©×•×œ××”", "total": 100, "paidAmount": 100, "createdDate": "2026-02-07", "approvedDate": "", "paidDate": "2026-02-12", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2008, "kind": "×—×©×‘×•× ×™×ª", "no": 558, "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "status": "×©×•×œ××”", "total": 80, "paidAmount": 80, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "2026-02-12", "performer": "×“× ×™", "source": "Meta"}, {"id": 2009, "kind": "×—×©×‘×•× ×™×ª", "no": 559, "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "status": "×©×•×œ××”", "total": 120, "paidAmount": 120, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "2026-02-16", "performer": "×œ×™×¨×•×Ÿ", "source": "×”××œ×¦×”"}, {"id": 2010, "kind": "×—×©×‘×•× ×™×ª", "no": 560, "customerNo": 112, "customerName": "×××™×” ×—×“×“", "status": "×¤×ª×•×—×”", "total": 80, "paidAmount": 0, "createdDate": "2026-02-04", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "×”××œ×¦×”"}, {"id": 2011, "kind": "×—×©×‘×•× ×™×ª", "no": 561, "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "status": "×©×•×œ××”", "total": 200, "paidAmount": 200, "createdDate": "2026-02-04", "approvedDate": "", "paidDate": "2026-02-07", "performer": "××™×¦×™×§", "source": "×”××œ×¦×”"}, {"id": 2012, "kind": "×—×©×‘×•× ×™×ª", "no": 562, "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "status": "×¤×ª×•×—×”", "total": 80, "paidAmount": 0, "createdDate": "2026-02-11", "approvedDate": "", "paidDate": "", "performer": "×œ×™×¨×•×Ÿ", "source": "×”××œ×¦×”"}, {"id": 2013, "kind": "×—×©×‘×•× ×™×ª", "no": 563, "customerNo": 107, "customerName": "×˜×œ ×™×©×¨××œ×™", "status": "×©×•×œ××”", "total": 120, "paidAmount": 120, "createdDate": "2026-02-07", "approvedDate": "", "paidDate": "2026-02-12", "performer": "××™×¦×™×§", "source": "Walk-in"}, {"id": 2014, "kind": "×—×©×‘×•× ×™×ª", "no": 564, "customerNo": 113, "customerName": "××œ×•×Ÿ ×¨×•×–×Ÿ", "status": "×©×•×œ××” ×—×œ×§×™×ª", "total": 250, "paidAmount": 125.0, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "2026-02-12", "performer": "××™×›×œ", "source": "×”××œ×¦×”"}, {"id": 2015, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 565, "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "status": "×××ª×™×Ÿ ×œ××™×©×•×¨", "total": 150, "paidAmount": 0, "createdDate": "2026-02-10", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "Google"}, {"id": 2016, "kind": "×—×©×‘×•× ×™×ª", "no": 566, "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "status": "×©×•×œ××”", "total": 100, "paidAmount": 100, "createdDate": "2026-02-09", "approvedDate": "", "paidDate": "2026-02-13", "performer": "××™×¦×™×§", "source": "×”××œ×¦×”"}, {"id": 2017, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 567, "customerNo": 101, "customerName": "×©× ×™ ××–×¨×—×™", "status": "×‘×•×˜×œ×”", "total": 100, "paidAmount": 0, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "", "performer": "×œ×™×¨×•×Ÿ", "source": "Walk-in"}, {"id": 2018, "kind": "×—×©×‘×•× ×™×ª", "no": 568, "customerNo": 107, "customerName": "×˜×œ ×™×©×¨××œ×™", "status": "×¤×ª×•×—×”", "total": 100, "paidAmount": 0, "createdDate": "2026-02-05", "approvedDate": "", "paidDate": "", "performer": "×“× ×™", "source": "Walk-in"}, {"id": 2019, "kind": "×—×©×‘×•× ×™×ª", "no": 569, "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "status": "×‘××™×—×•×¨", "total": 120, "paidAmount": 0, "createdDate": "2026-02-06", "approvedDate": "", "paidDate": "", "performer": "×œ×™×¨×•×Ÿ", "source": "Meta"}, {"id": 2020, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 570, "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "status": "×‘×•×˜×œ×”", "total": 150, "paidAmount": 0, "createdDate": "2026-02-06", "approvedDate": "", "paidDate": "", "performer": "×œ×™×¨×•×Ÿ", "source": "Google"}, {"id": 2021, "kind": "×—×©×‘×•× ×™×ª", "no": 571, "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "status": "×‘××™×—×•×¨", "total": 200, "paidAmount": 0, "createdDate": "2026-02-03", "approvedDate": "", "paidDate": "", "performer": "××™×¦×™×§", "source": "Meta"}, {"id": 2022, "kind": "×—×©×‘×•× ×™×ª", "no": 572, "customerNo": 115, "customerName": "××™×ª×™ ×¤×¨×¥", "status": "×‘××™×—×•×¨", "total": 100, "paidAmount": 0, "createdDate": "2026-02-01", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2023, "kind": "×—×©×‘×•× ×™×ª", "no": 573, "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "status": "×‘××™×—×•×¨", "total": 80, "paidAmount": 0, "createdDate": "2026-02-12", "approvedDate": "", "paidDate": "", "performer": "××™×¦×™×§", "source": "Google"}, {"id": 2024, "kind": "×—×©×‘×•× ×™×ª", "no": 574, "customerNo": 111, "customerName": "×œ×™××•×¨ ×©×—×¨", "status": "×¤×ª×•×—×”", "total": 80, "paidAmount": 0, "createdDate": "2026-02-09", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "××•×¨×’× ×™"}, {"id": 2025, "kind": "×—×©×‘×•× ×™×ª", "no": 575, "customerNo": 107, "customerName": "×˜×œ ×™×©×¨××œ×™", "status": "×¤×ª×•×—×”", "total": 200, "paidAmount": 0, "createdDate": "2026-02-02", "approvedDate": "", "paidDate": "", "performer": "×œ×™×¨×•×Ÿ", "source": "Walk-in"}, {"id": 2026, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 576, "customerNo": 118, "customerName": "×¢×•××¨ ××–×¨×—×™", "status": "×××ª×™×Ÿ ×œ××™×©×•×¨", "total": 120, "paidAmount": 0, "createdDate": "2026-02-08", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2027, "kind": "×—×©×‘×•× ×™×ª", "no": 577, "customerNo": 109, "customerName": "×©× ×™ ××–×¨×—×™", "status": "×‘××™×—×•×¨", "total": 150, "paidAmount": 0, "createdDate": "2026-02-09", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "××•×¨×’× ×™"}, {"id": 2028, "kind": "×—×©×‘×•× ×™×ª", "no": 578, "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "status": "×‘××™×—×•×¨", "total": 150, "paidAmount": 0, "createdDate": "2026-02-04", "approvedDate": "", "paidDate": "", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2029, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 579, "customerNo": 114, "customerName": "×¢×“×™ ×§×“×", "status": "××•×©×¨×”", "total": 80, "paidAmount": 0, "createdDate": "2026-02-08", "approvedDate": "2026-02-10", "paidDate": "", "performer": "××™×›×œ", "source": "Meta"}, {"id": 2030, "kind": "×”×¦×¢×ª ××—×™×¨", "no": 580, "customerNo": 114, "customerName": "×¢×“×™ ×§×“×", "status": "×××ª×™×Ÿ ×œ××™×©×•×¨", "total": 120, "paidAmount": 0, "createdDate": "2026-02-11", "approvedDate": "", "paidDate": "", "performer": "××™×¦×™×§", "source": "Meta"}, {"id": 2031, "kind": "×—×©×‘×•× ×™×ª", "no": 581, "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "status": "×©×•×œ××”", "total": 150, "paidAmount": 150, "createdDate": "2026-02-05", "approvedDate": "", "paidDate": "2026-02-06", "performer": "××™×›×œ", "source": "Google"}, {"id": 2032, "kind": "×—×©×‘×•× ×™×ª", "no": 582, "customerNo": 104, "customerName": "×¨×•×¢×™ ×›×”×Ÿ", "status": "×©×•×œ××” ×—×œ×§×™×ª", "total": 100, "paidAmount": 50.0, "createdDate": "2026-02-03", "approvedDate": "", "paidDate": "2026-02-08", "performer": "×œ×™×¨×•×Ÿ", "source": "Walk-in"}, {"id": 2033, "kind": "×—×©×‘×•× ×™×ª", "no": 583, "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "status": "×©×•×œ××”", "total": 120, "paidAmount": 120, "createdDate": "2026-02-07", "approvedDate": "", "paidDate": "2026-02-08", "performer": "×“× ×™", "source": "Meta"}],
  expenses: [{"id": 3000, "date": "2026-02-02", "category": "×¦×™×•×“", "amount": 45, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "×œ×™×¨×•×Ÿ"}, {"id": 3001, "date": "2026-02-08", "category": "×©×›×™×¨×•×ª", "amount": 600, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "×“× ×™"}, {"id": 3002, "date": "2026-02-09", "category": "×¤×¨×¡×•× Google", "amount": 80, "source": "Google", "assignedToStaff": false, "staff": ""}, {"id": 3003, "date": "2026-02-04", "category": "×¤×¨×¡×•× Google", "amount": 80, "source": "Google", "assignedToStaff": true, "staff": "××™×¦×™×§"}, {"id": 3004, "date": "2026-02-03", "category": "×—×•××¨×™ ×¢×‘×•×“×”", "amount": 120, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3005, "date": "2026-02-11", "category": "×—×•××¨×™ ×¢×‘×•×“×”", "amount": 600, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "×œ×™×¨×•×Ÿ"}, {"id": 3006, "date": "2026-02-12", "category": "×¦×™×•×“", "amount": 80, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "××™×›×œ"}, {"id": 3007, "date": "2026-02-07", "category": "×¤×¨×¡×•× Google", "amount": 250, "source": "Google", "assignedToStaff": false, "staff": ""}, {"id": 3008, "date": "2026-02-11", "category": "×¤×¨×¡×•× Google", "amount": 250, "source": "Google", "assignedToStaff": true, "staff": "××™×›×œ"}, {"id": 3009, "date": "2026-02-02", "category": "×—×•××¨×™ ×¢×‘×•×“×”", "amount": 80, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3010, "date": "2026-02-06", "category": "×§×¤×”/×›×™×‘×•×“", "amount": 250, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3011, "date": "2026-02-01", "category": "×“×œ×§", "amount": 80, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3012, "date": "2026-02-05", "category": "×©×›×™×¨×•×ª", "amount": 120, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "×“× ×™"}, {"id": 3013, "date": "2026-02-11", "category": "×—×•××¨×™ ×¢×‘×•×“×”", "amount": 1200, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3014, "date": "2026-02-05", "category": "××—×¨", "amount": 1200, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3015, "date": "2026-02-05", "category": "×¦×™×•×“", "amount": 45, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3016, "date": "2026-02-01", "category": "×©×›×™×¨×•×ª", "amount": 45, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3017, "date": "2026-02-09", "category": "×“×œ×§", "amount": 1200, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3018, "date": "2026-02-08", "category": "×¤×¨×¡×•× Google", "amount": 600, "source": "Google", "assignedToStaff": false, "staff": ""}, {"id": 3019, "date": "2026-02-09", "category": "×§×¤×”/×›×™×‘×•×“", "amount": 1200, "source": "×™×“× ×™", "assignedToStaff": true, "staff": "××™×›×œ"}, {"id": 3020, "date": "2026-02-04", "category": "×¦×™×•×“", "amount": 180, "source": "×™×“× ×™", "assignedToStaff": false, "staff": ""}, {"id": 3021, "date": "2026-02-12", "category": "×¤×¨×¡×•× Meta", "amount": 600, "source": "Meta", "assignedToStaff": false, "staff": ""}],
  appts: [{"id": 4000, "date": "2026-02-03", "time": "09:00", "customerNo": 102, "customerName": "××•×¨ ×›×”×Ÿ", "service": "×¦×‘×¢", "staff": "×“× ×™", "status": "×××ª×™×Ÿ"}, {"id": 4001, "date": "2026-02-01", "time": "10:45", "customerNo": 106, "customerName": "× ×•×¢×” ×—×“×“", "service": "×¤×Ÿ", "staff": "×“× ×™", "status": "×‘×•×˜×œ"}, {"id": 4002, "date": "2026-02-12", "time": "13:00", "customerNo": 108, "customerName": "×©×§×“ ××‘×¨×”×", "service": "×’×•×•× ×™×", "staff": "××™×›×œ", "status": "×××•×©×¨"}, {"id": 4003, "date": "2026-02-08", "time": "09:30", "customerNo": 109, "customerName": "×©× ×™ ××–×¨×—×™", "service": "×–×§×Ÿ", "staff": "×“× ×™", "status": "×‘×•×˜×œ"}, {"id": 4004, "date": "2026-02-04", "time": "09:30", "customerNo": 111, "customerName": "×œ×™××•×¨ ×©×—×¨", "service": "×ª×¡×¤×•×¨×ª+×–×§×Ÿ", "staff": "×“× ×™", "status": "×××•×©×¨"}, {"id": 4005, "date": "2026-02-06", "time": "15:00", "customerNo": 101, "customerName": "×©× ×™ ××–×¨×—×™", "service": "×’×•×•× ×™×", "staff": "×“× ×™", "status": "×‘×•×˜×œ"}, {"id": 4006, "date": "2026-02-04", "time": "17:00", "customerNo": 107, "customerName": "×˜×œ ×™×©×¨××œ×™", "service": "×ª×¡×¤×•×¨×ª", "staff": "×“× ×™", "status": "×××•×©×¨"}, {"id": 4007, "date": "2026-02-07", "time": "18:00", "customerNo": 105, "customerName": "×œ×™××•×¨ ×“×•×™×“", "service": "×’×•×•× ×™×", "staff": "××™×¦×™×§", "status": "×××ª×™×Ÿ"}, {"id": 4008, "date": "2026-02-11", "time": "12:00", "customerNo": 110, "customerName": "×˜×œ ×—×“×“", "service": "×¤×Ÿ", "staff": "××™×›×œ", "status": "×‘×•×˜×œ"}, {"id": 4009, "date": "2026-02-06", "time": "16:15", "customerNo": 113, "customerName": "××œ×•×Ÿ ×¨×•×–×Ÿ", "service": "×–×§×Ÿ", "staff": "××™×›×œ", "status": "×××•×©×¨"}, {"id": 4010, "date": "2026-02-11", "time": "15:15", "customerNo": 117, "customerName": "××œ×•×Ÿ ×‘×™×˜×•×Ÿ", "service": "×¤×Ÿ", "staff": "××™×¦×™×§", "status": "×‘×•×˜×œ"}, {"id": 4011, "date": "2026-02-02", "time": "09:00", "customerNo": 108, "customerName": "×©×§×“ ××‘×¨×”×", "service": "×ª×¡×¤×•×¨×ª+×–×§×Ÿ", "staff": "×“× ×™", "status": "×××•×©×¨"}, {"id": 4012, "date": "2026-02-08", "time": "17:00", "customerNo": 113, "customerName": "××œ×•×Ÿ ×¨×•×–×Ÿ", "service": "×¦×‘×¢", "staff": "××™×¦×™×§", "status": "×‘×•×˜×œ"}, {"id": 4013, "date": "2026-02-11", "time": "12:45", "customerNo": 118, "customerName": "×¢×•××¨ ××–×¨×—×™", "service": "×–×§×Ÿ", "staff": "××™×¦×™×§", "status": "×××ª×™×Ÿ"}, {"id": 4014, "date": "2026-02-12", "time": "17:00", "customerNo": 103, "customerName": "× ×•×¢×” ×—×“×“", "service": "×¦×‘×¢", "staff": "××™×¦×™×§", "status": "×‘×•×˜×œ"}, {"id": 4015, "date": "2026-02-05", "time": "10:30", "customerNo": 116, "customerName": "×“× ×” ×“×•×™×“", "service": "×ª×¡×¤×•×¨×ª+×–×§×Ÿ", "staff": "××™×›×œ", "status": "×××•×©×¨"}, {"id": 4016, "date": "2026-02-08", "time": "15:00", "customerNo": 115, "customerName": "××™×ª×™ ×¤×¨×¥", "service": "×’×•×•× ×™×", "staff": "×“× ×™", "status": "×××•×©×¨"}, {"id": 4017, "date": "2026-02-02", "time": "18:15", "customerNo": 107, "customerName": "×˜×œ ×™×©×¨××œ×™", "service": "×–×§×Ÿ", "staff": "×“× ×™", "status": "×‘×•×˜×œ"}],
};

/* Workspaces + Boards (Monday-like) */
const workspaces = [
  {id:"w1", name:"××™×¦×™×§ â€¢ ×”××¡×¤×¨×”", tenantId:1, boards:[
    {id:"b1", name:"CRM ××¡×¤×¨×”", preset:"salon", icon:"âœ‚ï¸"},
    {id:"b2", name:"×©×™×•×•×§ / ×§××¤×™×™× ×™×", preset:"marketing", icon:"ğŸ“£"},
    {id:"b3", name:"××©×™××•×ª ×¦×•×•×ª", preset:"tasks", icon:"âœ…"},
  ]},
  {id:"w2", name:"××œ×¤× â€¢ ××•×¡×š", tenantId:2, boards:[
    {id:"b4", name:"CRM ××•×¡×š", preset:"garage", icon:"ğŸ”§"},
    {id:"b5", name:"××œ××™ ×•×—×œ×¤×™×", preset:"inventory", icon:"ğŸ“¦"},
  ]},
  {id:"w3", name:"× ×•×¢×” â€¢ ×¡×˜×•×“×™×•", tenantId:3, boards:[
    {id:"b6", name:"CRM ×¡×˜×•×“×™×•", preset:"studio", icon:"ğŸ§˜"},
  ]},
];

/* App State */
let ui = {
  workspaceId:"w1",
  boardId:"b1",
  page:"dashboard",
  role:"Owner",
  range: {from:"2026-02-01", to:"2026-02-12"},
  compare:false,
  floatTodo:true,
  screenConfig: {
    show: {
      dashboard:true, customers:true, docs:true, calendar:true, expenses:true, tasks:true, inventory:true, marketing:true, automations:true, reports:true, communications:true
    }
  },
  dash: {
    cols: 12, rowH: 64, gap: 10,
    tiles: [
      {id:"kpi_income", type:"kpi", title:"×”×›× ×¡×” ×‘×¤×•×¢×œ", color:"blue", metric:"actualIncome", x:0,y:0,w:3,h:2},
      {id:"kpi_expected", type:"kpi", title:"×”×›× ×¡×” ×¦×¤×•×™×”", color:"purple", metric:"expectedIncome", x:3,y:0,w:3,h:2},
      {id:"kpi_exp", type:"kpi", title:"×”×•×¦××•×ª", color:"amber", metric:"totalExpenses", x:6,y:0,w:3,h:2},
      {id:"kpi_profit", type:"kpi", title:"×¨×•×•×—", color:"green", metric:"netProfit", x:9,y:0,w:3,h:2},
      {id:"chart_income", type:"chart", title:"××’××ª ×”×›× ×¡×•×ª", color:"blue", chart:"line_income", x:0,y:2,w:7,h:4},
      {id:"table_staff", type:"table", title:"×‘×™×¦×•×¢×™× ×œ×¤×™ ×¢×•×‘×“", color:"teal", table:"staff_perf", x:7,y:2,w:5,h:4},
      {id:"todo", type:"todo", title:"××©×™××•×ª ×¤×ª×•×—×•×ª", color:"amber", x:0,y:6,w:5,h:4},
      {id:"docs_attention", type:"table", title:"××¡××›×™× ×¤×ª×•×—×™× / ×‘××™×—×•×¨", color:"red", table:"docs_attention", x:5,y:6,w:7,h:4},
    ]
  }
};

/* Tasks (Toâ€‘Do) */
const tasks = [
  {id:"t1", title:"×‘×“×™×§×ª ×ª××—×•×¨ ×©×™×¨×•×ª '×©×™×¢×¨+×–×§×Ÿ'", priority:"×‘×™× ×•× ×™×ª", status:"×¤×ª×•×—×”", stage:"×¤×ª×•×—", assignee:"××™×¦×™×§", due:"2026-02-14", source:"×™×“× ×™"},
  {id:"t2", title:"×ª×–×›×•×¨×ª ×œ×œ×§×•×—: ×—×©×‘×•× ×™×ª #1048 ×‘××™×—×•×¨", priority:"×’×‘×•×”×”", status:"×¤×ª×•×—×”", stage:"×‘×ª×”×œ×™×š", assignee:"××™×›×œ", due:"2026-02-12", source:"AI", link:{type:"doc", no:1048} },
  {id:"t3", title:"×¤×•×œ×•××¤ ×œ×”×¦×¢×ª ××—×™×¨ ×©×××ª×™× ×” ×œ××™×©×•×¨", priority:"×‘×™× ×•× ×™×ª", status:"×¤×ª×•×—×”", stage:"×¤×ª×•×—", assignee:"×“× ×™", due:"2026-02-13", source:"AI"},
];

/* Notifications */
let notifications = [
  {id:"n1", ts:"2026-02-12 09:12", title:"×”×¦×¢×ª ××—×™×¨ ××•×©×¨×”", body:"×œ×§×•×— ××™×©×¨ ×”×¦×¢×ª ××—×™×¨ #2051", tone:"teal"},
  {id:"n2", ts:"2026-02-12 10:01", title:"×—×©×‘×•× ×™×ª ×‘××™×—×•×¨", body:"×—×©×‘×•× ×™×ª #1048 ×‘××™×—×•×¨ â€” × ×•×¦×¨×” ××©×™××” ×œ××™×›×œ", tone:"red"},
  {id:"n3", ts:"2026-02-12 11:30", title:"AI Insight", body:"ROI Meta × ××•×š ×”×©×‘×•×¢ â€” ××•××œ×¥ ×œ×¢×¦×•×¨ ×§××¤×™×™×Ÿ", tone:"amber"},
];

/* Automations (IF/THEN demo) */
let automations = [
  {id:"a1", name:"×—×©×‘×•× ×™×ª ×‘××™×—×•×¨ â†’ ×¦×•×¨ ××©×™××ª ×ª×–×›×•×¨×ª", enabled:true, if:"Invoice overdue", then:"Create task + notify", severity:"×’×‘×•×”×”"},
  {id:"a2", name:"×¨×•×•×— ×©×œ×™×œ×™ â†’ ××©×™××” ×œ×‘×“×•×§ ×”×•×¦××•×ª/×ª××—×•×¨", enabled:true, if:"Net profit < 0", then:"Create task to owner", severity:"×’×‘×•×”×”"},
  {id:"a3", name:"×”×¦×¢×ª ××—×™×¨ ×××ª×™× ×” â†’ ×¤×•×œ×•××¤", enabled:true, if:"Quote pending > 2 days", then:"Create task to employee", severity:"×‘×™× ×•× ×™×ª"},
];

/* Inventory demo (generic) */
let inventory = [
  {sku:"BLADE-01", name:"×¡×›×™× ×™ ××›×•× ×”", qty:14, unit:"×™×—×³", cost:18.5},
  {sku:"GEL-250", name:"×’×³×œ ×œ×©×™×¢×¨ 250ml", qty:22, unit:"×™×—×³", cost:9.9},
  {sku:"SHAMPOO-1L", name:"×©××¤×• 1 ×œ×™×˜×¨", qty:8, unit:"×‘×§×‘×•×§", cost:21.0},
];

/* Marketing spend demo */
let marketing = [
  {date:"2026-02-02", channel:"Google", spend:120.0, leads:9, revenue:360.0},
  {date:"2026-02-05", channel:"Meta", spend:180.0, leads:7, revenue:240.0},
  {date:"2026-02-08", channel:"Google", spend:90.0, leads:5, revenue:190.0},
];

/* Communications (calls/emails) demo */
let comms = [
  {ts:"2026-02-11 16:05", type:"×©×™×—×”", from:"×™×•×‘×œ", summary:"×©××œ ×¢×œ ×©×™× ×•×™ ×ª×•×¨, AI ×¡×™×›×", sentiment:"×—×™×•×‘×™"},
  {ts:"2026-02-12 09:40", type:"××™×™×œ", from:"× ×•×¢×”", summary:"×‘×§×©×” ×œ×”×¦×¢×ª ××—×™×¨ ×œ×—×‘×™×œ×ª ×˜×™×¤×•×œ", sentiment:"× ×™×˜×¨×œ×™"},
];

/* ===================== HELPERS ===================== */
function toggleNav(){ document.body.classList.toggle("nav-open"); }
function parseDate(s){ return new Date(s+"T00:00:00"); }
function inRange(dateStr){ const d=parseDate(dateStr), f=parseDate(ui.range.from), t=parseDate(ui.range.to); return d>=f && d<=t; }
function money(n){ return "â‚ª" + (Math.round(n*100)/100).toLocaleString("he-IL"); }
function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
function uuid(prefix="id"){ return prefix+"_"+Math.random().toString(16).slice(2); }
function toast(msg, tone="blue"){
  const el=document.createElement("div"); el.className="toast";
  const tClass = tone==="red"?"red":tone==="amber"?"amber":tone==="teal"?"teal":tone==="purple"?"purple":"blue";
  el.innerHTML=`<div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start">
    <div><div style="font-weight:950">ğŸ”” ${msg}</div><div class="small">PRO Demo â€¢ ${new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})}</div></div>
    <span class="badge ${tClass}">${tone}</span>
  </div>`;
  const box=document.getElementById("toasts");
  box.appendChild(el);
  setTimeout(()=>{ el.style.opacity="0"; el.style.transform="translateY(6px)"; el.style.transition=".22s ease"; }, 2600);
  setTimeout(()=>{ el.remove(); }, 3100);
}
function openModal(title, bodyHtml){ document.getElementById("mTitle").innerText=title; document.getElementById("mBody").innerHTML=bodyHtml; document.getElementById("modal").style.display="flex"; }
function closeModal(){ document.getElementById("modal").style.display="none"; }
function openCmdK(){ document.getElementById("cmdk").style.display="flex"; const i=document.getElementById("cmdkInput"); i.value=""; renderCmdK(""); setTimeout(()=>i.focus(), 30); }
function closeCmdK(){ document.getElementById("cmdk").style.display="none"; }
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape"){ closeCmdK(); closeModal(); } if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==="k"){ e.preventDefault(); openCmdK(); } });
document.addEventListener("input",(e)=>{ if(e.target && e.target.id==="cmdkInput") renderCmdK(e.target.value||""); });

function setNotifDot(){ document.getElementById("notifDot").style.display = notifications.length ? "block" : "none"; }

/* ===================== SUMMARY / KPIs ===================== */
function calcSummary(range){
  const inR = (ds)=>{ const d=parseDate(ds), f=parseDate(range.from), t=parseDate(range.to); return d>=f && d<=t; };
  const invoicesCreated = demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && inR(d.createdDate));
  const approvedQuotes = demo.docs.filter(d=>d.kind==="×”×¦×¢×ª ××—×™×¨" && d.status==="××•×©×¨×”" && d.approvedDate && inR(d.approvedDate));
  const paidInRange = demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && d.paidDate && inR(d.paidDate) && ["×©×•×œ××”","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status));
  const actualIncome = paidInRange.reduce((s,d)=>s+d.paidAmount,0);
  const expectedIncome = approvedQuotes.reduce((s,d)=>s+d.total,0) + invoicesCreated.filter(d=>["×¤×ª×•×—×”","×‘××™×—×•×¨","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status)).reduce((s,d)=>s+(d.total-d.paidAmount),0);
  const totalExpenses = demo.expenses.filter(e=>inR(e.date)).reduce((s,e)=>s+e.amount,0);
  const netProfit = actualIncome - totalExpenses;
  const overdueInvoices = invoicesCreated.filter(d=>d.status==="×‘××™×—×•×¨").length;
  const pendingQuotes = demo.docs.filter(d=>d.kind==="×”×¦×¢×ª ××—×™×¨" && d.status==="×××ª×™×Ÿ ×œ××™×©×•×¨" && inR(d.createdDate)).length;
  return {actualIncome, expectedIncome, totalExpenses, netProfit, overdueInvoices, pendingQuotes};
}
function prevRange(){ const f=parseDate(ui.range.from), t=parseDate(ui.range.to); const days=Math.round((t-f)/86400000)+1; const prevTo=new Date(f.getTime()-86400000); const prevFrom=new Date(prevTo.getTime()-(days-1)*86400000); const iso=(d)=>d.toISOString().slice(0,10); return {from:iso(prevFrom), to:iso(prevTo)}; }
function deltaPill(curr, prev){ if(prev===0 && curr===0) return `<span class="pill">0%</span>`; if(prev===0) return `<span class="pill teal">+âˆ</span>`; const pct=((curr-prev)/prev)*100; const cls=pct>=0?"teal":"red"; const sign=pct>=0?"+":""; return `<span class="pill ${cls}">${sign}${pct.toFixed(1)}%</span>`; }

/* ===================== AI INSIGHTS & AUTOMATIONS ===================== */
function aiInsights(summary){
  const googleSpend = demo.expenses.filter(e=>inRange(e.date) && e.source==="Google").reduce((a,b)=>a+b.amount,0);
  const metaSpend = demo.expenses.filter(e=>inRange(e.date) && e.source==="Meta").reduce((a,b)=>a+b.amount,0);
  const googleIncome = demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && d.paidDate && inRange(d.paidDate) && ["×©×•×œ××”","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status) && d.source==="Google").reduce((a,b)=>a+b.paidAmount,0);
  const metaIncome = demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && d.paidDate && inRange(d.paidDate) && ["×©×•×œ××”","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status) && d.source==="Meta").reduce((a,b)=>a+b.paidAmount,0);
  const roi=(inc,sp)=> sp<=0?null:(inc/sp);
  const gap = summary.expectedIncome - summary.actualIncome;
  const out=[];
  out.push({t:"×¤×¢×¨ ×‘×™×Ÿ ×¦×¤×•×™ ×œ×‘×¤×•×¢×œ", d:`×¤×¢×¨ ×©×œ ${money(gap)}`, sev: gap>0? "amber":"teal"});
  if(summary.overdueInvoices>0) out.push({t:"×—×©×‘×•× ×™×•×ª ×‘××™×—×•×¨", d:`${summary.overdueInvoices} ×‘××™×—×•×¨ â€” ××•××œ×¥ ×ª×–×›×•×¨×ª`, sev:"red"});
  if(googleSpend>0) out.push({t:"ROI Google", d:`×”×•×¦××” ${money(googleSpend)} â€¢ ×”×›× ×¡×” ${money(googleIncome)} â€¢ ROI ${roi(googleIncome,googleSpend)?roi(googleIncome,googleSpend).toFixed(1)+"Ã—":"â€”"}`, sev: roi(googleIncome,googleSpend) && roi(googleIncome,googleSpend)<1 ? "red":"teal"});
  if(metaSpend>0) out.push({t:"ROI Meta", d:`×”×•×¦××” ${money(metaSpend)} â€¢ ×”×›× ×¡×” ${money(metaIncome)} â€¢ ROI ${roi(metaIncome,metaSpend)?roi(metaIncome,metaSpend).toFixed(1)+"Ã—":"â€”"}`, sev: roi(metaIncome,metaSpend) && roi(metaIncome,metaSpend)<1 ? "red":"teal"});
  if(summary.netProfit<0) out.push({t:"××–×”×¨×ª ×¨×•×•×—", d:"×”×¨×•×•×— ×‘×˜×•×•×— ×©×œ×™×œ×™ â€” ×‘×“×•×§ ×”×•×¦××•×ª/×ª××—×•×¨", sev:"red"});
  return out.slice(0,6);
}

function ensureTask(title, opts){
  const exists = tasks.some(t=>t.title===title && t.source===opts.source);
  if(exists) return;
  tasks.unshift({id:uuid("t"), title, priority:opts.priority||"×‘×™× ×•× ×™×ª", status:"×¤×ª×•×—×”", stage:opts.stage||"×¤×ª×•×—", assignee:opts.assignee||"××™×¦×™×§", due:opts.due||ui.range.to, source:opts.source||"AI", link:opts.link||null});
  toast("× ×•×¦×¨×” ××©×™××”: "+title, opts.priority==="×’×‘×•×”×”"?"red":"amber");
}

function runAuto(){
  const s=calcSummary(ui.range);
  const rule=(id)=>automations.find(a=>a.id===id)?.enabled;
  if(rule("a1")){
    const overdue = demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && d.status==="×‘××™×—×•×¨" && inRange(d.createdDate)).slice(0,6);
    overdue.forEach(d=> ensureTask(`×ª×–×›×•×¨×ª ×œ×œ×§×•×—: ×—×©×‘×•× ×™×ª #${d.no} ×‘××™×—×•×¨`, {source:"AI", priority:"×’×‘×•×”×”", assignee:"××™×›×œ", stage:"×‘×ª×”×œ×™×š", due:ui.range.to, link:{type:"doc", no:d.no}}));
  }
  if(rule("a2") && s.netProfit<0) ensureTask("×‘×“×•×§ ×”×•×¦××•×ª ×•×ª××—×•×¨ â€” ×¨×•×•×— ×©×œ×™×œ×™ ×‘×˜×•×•×—", {source:"AI", priority:"×’×‘×•×”×”", assignee:"××™×¦×™×§", stage:"×¤×ª×•×—", due:ui.range.to});
  if(rule("a3")){
    const pending=demo.docs.filter(d=>d.kind==="×”×¦×¢×ª ××—×™×¨" && d.status==="×××ª×™×Ÿ ×œ××™×©×•×¨" && inRange(d.createdDate)).slice(0,4);
    pending.forEach(d=> ensureTask(`×¤×•×œ×•××¤ ×œ×”×¦×¢×ª ××—×™×¨ #${d.no} (×××ª×™×Ÿ ×œ××™×©×•×¨)`, {source:"AI", priority:"×‘×™× ×•× ×™×ª", assignee:"×“× ×™", stage:"×¤×ª×•×—", due:ui.range.to, link:{type:"doc", no:d.no}}));
  }
  refreshBadges();
  renderFloatTodo();
}

/* ===================== UI: NAV / WORKSPACE / BOARD ===================== */
function initWorkspaceSelect(){
  const sel=document.getElementById("workspaceSelect");
  sel.innerHTML = workspaces.map(w=>`<option value="${w.id}">${w.name}</option>`).join("");
  sel.value = ui.workspaceId;
}
function currentWorkspace(){ return workspaces.find(w=>w.id===ui.workspaceId) || workspaces[0]; }
function currentBoard(){ const w=currentWorkspace(); return w.boards.find(b=>b.id===ui.boardId) || w.boards[0]; }
function switchWorkspace(id){
  ui.workspaceId=id;
  const w=currentWorkspace();
  ui.boardId=w.boards[0].id;
  const tenant=demo.tenants.find(t=>t.id===w.tenantId)||demo.tenants[0];
  document.getElementById("tenantTitle").innerText = tenant.name;
  toast("×”×•×—×œ×£ Workspace: "+w.name, "teal");
  renderBoards();
  go("dashboard");
}
function renderBoards(){
  const w=currentWorkspace();
  const box=document.getElementById("boardList");
  box.innerHTML = w.boards.map(b=>{
    const active = b.id===ui.boardId ? "active" : "";
    return `<button class="btn boardBtn ${active}" onclick="switchBoard('${b.id}')">
      <span>${b.icon} ${b.name}</span>
      <span class="badge purple">${b.preset}</span>
    </button>`;
  }).join("");
}
function switchBoard(id){
  ui.boardId=id;
  const b=currentBoard();
  document.getElementById("contextLine").innerText = `Board: ${b.name} â€¢ ${b.preset} â€¢ ××•×“×•×œ×™×`;
  toast("×”×•×—×œ×£ Board: "+b.name, "purple");
  go("dashboard");
}

/* Role switcher (demo) */
function setRole(role){
  ui.role=role;
  document.getElementById("roleBadge").textContent=role;
  toast("×ª×¤×§×™×“: "+role, "blue");
  render();
}

/* Navigation items */
const NAV_ITEMS = [
  {id:"dashboard", label:"×“×©×‘×•×¨×“", tag:"KPI", key:"dashboard"},
  {id:"customers", label:"×œ×§×•×—×•×ª", tag:"CRM", key:"customers"},
  {id:"docs", label:"××¡××›×™×", tag:"Quotes/Invoices", key:"docs"},
  {id:"calendar", label:"×™×•××Ÿ ×ª×•×¨×™×", tag:"Scheduler", key:"calendar"},
  {id:"tasks", label:"××©×™××•×ª", tag:"Board", key:"tasks"},
  {id:"expenses", label:"×”×•×¦××•×ª", tag:"Finance", key:"expenses"},
  {id:"inventory", label:"××œ××™", tag:"Stock", key:"inventory"},
  {id:"marketing", label:"×©×™×•×•×§ (Ads)", tag:"ROI", key:"marketing"},
  {id:"communications", label:"×©×™×—×•×ª/××™×™×œ×™×", tag:"AI Analysis", key:"communications"},
  {id:"automations", label:"××•×˜×•××¦×™×•×ª", tag:"IF/THEN", key:"automations"},
  {id:"reports", label:"×“×•×—×•×ª", tag:"Builder", key:"reports"},
];

/* Screen config rules by role (demo) */
function canAccess(id){
  if(ui.role==="Employee"){
    // employee limited: customers/docs/calendar/tasks (self), no settings/automations/reports advanced
    return ["dashboard","customers","docs","calendar","tasks"].includes(id);
  }
  return true;
}

/* ===================== COMMAND BAR ===================== */
function renderCmdK(q){
  q=(q||"").trim().toLowerCase();
  const items=[];
  // Commands
  items.push({label:"×¤×ª×— ×“×©×‘×•×¨×“", meta:"× ×™×•×•×˜", fn:()=>go("dashboard")});
  items.push({label:"×¤×ª×— ×œ×§×•×—×•×ª", meta:"× ×™×•×•×˜", fn:()=>go("customers")});
  items.push({label:"×¤×ª×— ××¡××›×™×", meta:"× ×™×•×•×˜", fn:()=>go("docs")});
  items.push({label:"+ ××©×™××” ×—×“×©×”", meta:"×¤×¢×•×œ×”", fn:()=>quickCreateTask()});
  items.push({label:"+ Widget ×œ×“×©×‘×•×¨×“", meta:"Builder", fn:()=>openWidgetBuilder()});
  items.push({label:"AI ×ª×•×‘× ×•×ª", meta:"AI", fn:()=>openAI()});
  // Entities
  demo.customers.slice(0,60).forEach(c=> items.push({label:`×œ×§×•×—: ${c.name}`, meta:`#${c.no} â€¢ ${c.phone}`, fn:()=>openCustomer(c.no)}));
  demo.docs.slice(0,60).forEach(d=> items.push({label:`××¡××š: #${d.no} (${d.kind} )`, meta:`${d.customerName} â€¢ ${d.status}`, fn:()=>openDoc(d.no)}));
  demo.appts.slice(0,40).forEach(a=> items.push({label:`×ª×•×¨: ${a.customerName} (${a.date} ${a.time} )`, meta:`${a.service} â€¢ ${a.staff}`, fn:()=>openAppt(a)}));
  // Filter
  const filtered = items.filter(it=>!q || (it.label+" "+it.meta).toLowerCase().includes(q)).slice(0,14);
  document.getElementById("cmdkList").innerHTML = filtered.map(it=>`
    <div class="row" onclick="(${it.fn.toString()})()">
      <div>
        <div style="font-weight:950">${it.label}</div>
        <div class="small">${it.meta}</div>
      </div>
      <span class="kbd">Enter</span>
    </div>
  `).join("");
}

/* ===================== DASHBOARD BUILDER ===================== */
function gridSize(){
  const wrap=document.getElementById("canvas");
  const rect=wrap.getBoundingClientRect();
  const cols=ui.dash.cols, gap=ui.dash.gap;
  const colW=(rect.width-(cols-1)*gap)/cols;
  return {rect, cols, gap, colW, rowH:ui.dash.rowH};
}
function tileRect(t){
  const gs=gridSize();
  const left=t.x*(gs.colW+gs.gap);
  const top=t.y*(gs.rowH+gs.gap);
  const width=t.w*gs.colW+(t.w-1)*gs.gap;
  const height=t.h*gs.rowH+(t.h-1)*gs.gap;
  return {left, top, width, height};
}

function dailyIncomeSeries(range){
  const f=parseDate(range.from), t=parseDate(range.to);
  const days=Math.round((t-f)/86400000)+1;
  const out=[];
  for(let i=0;i<days;i++){ 
    const d=new Date(f.getTime()+i*86400000);
    const ds=d.toISOString().slice(0,10);
    const v=demo.docs.filter(x=>x.kind==="×—×©×‘×•× ×™×ª" && x.paidDate===ds && ["×©×•×œ××”","×©×•×œ××” ×—×œ×§×™×ª"].includes(x.status)).reduce((s,x)=>s+x.paidAmount,0);
    out.push({ds,v});
  }
  return out;
}
function renderLineChart(series, seriesPrev){
  const max=Math.max(1, ...series.map(s=>s.v), ...(seriesPrev?seriesPrev.map(s=>s.v):[]));
  const pts=(ser)=>ser.map((s,i)=>{ const x=(i/(Math.max(1,ser.length-1)))*100; const y=100-(s.v/max)*80-10; return `${x.toFixed(2)},${y.toFixed(2)}`; }).join(" ");
  const bars=series.map((s,i)=>{ const x=(i/(series.length))*100; const w=100/series.length-0.8; const h=(s.v/max)*80; const y=100-h-10; return `<rect x="${x+0.4}" y="${y}" width="${w}" height="${h}" rx="2.2" ry="2.2" fill="rgba(87,155,252,.20)"/>`; }).join("");
  const prevLine=seriesPrev?`<polyline fill="none" stroke="rgba(168,85,247,.70)" stroke-width="1.4" points="${pts(seriesPrev)}"/>`:"";
  return `<div class="spark"><svg viewBox="0 0 100 100" preserveAspectRatio="none" style="width:100%;height:100%">${bars}${prevLine}<polyline fill="none" stroke="rgba(87,155,252,.95)" stroke-width="1.8" points="${pts(series)}"/></svg></div>`;
}
function staffPerfRows(){
  const paid=demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && d.paidDate && inRange(d.paidDate) && ["×©×•×œ××”","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status));
  const by=new Map();
  for(const d of paid){
    const k=d.performer;
    const cur=by.get(k)||{name:k,income:0,count:0};
    cur.income+=d.paidAmount; cur.count+=1;
    by.set(k,cur);
  }
  const rows=[...by.values()];
  const total=rows.reduce((s,r)=>s+r.income,0)||1;
  rows.forEach(r=>r.share=(r.income/total)*100);
  rows.sort((a,b)=>b.income-a.income);
  return rows.slice(0,7);
}

/* Drag / resize dashboard tiles */
let dragState=null;
function onPointerDown(e, tileId, mode){
  e.preventDefault();
  const tile=ui.dash.tiles.find(t=>t.id===tileId);
  if(!tile) return;
  dragState={mode,tileId,startX:e.clientX,startY:e.clientY,orig:{...tile},gs:gridSize()};
  document.body.classList.add("dragging");
  window.addEventListener("pointermove", onPointerMove);
  window.addEventListener("pointerup", onPointerUp, {once:true});
}
function onPointerMove(e){
  if(!dragState) return;
  const tile=ui.dash.tiles.find(t=>t.id===dragState.tileId);
  if(!tile) return;
  const dx=e.clientX-dragState.startX;
  const dy=e.clientY-dragState.startY;
  const gs=dragState.gs;
  const unitX=gs.colW+gs.gap;
  const unitY=gs.rowH+gs.gap;
  if(dragState.mode==="move"){
    const nx=Math.round((dragState.orig.x*unitX+dx)/unitX);
    const ny=Math.round((dragState.orig.y*unitY+dy)/unitY);
    tile.x=clamp(nx,0,gs.cols-tile.w);
    tile.y=clamp(ny,0,200);
  } else {
    const nw=Math.round((dragState.orig.w*unitX+dx)/unitX);
    const nh=Math.round((dragState.orig.h*unitY+dy)/unitY);
    tile.w=clamp(nw,2,gs.cols-tile.x);
    tile.h=clamp(nh,2,16);
  }
  renderDashboard();
}
function onPointerUp(){
  document.body.classList.remove("dragging");
  window.removeEventListener("pointermove", onPointerMove);
  dragState=null;
}

function renderTileContent(tile, summary, prevSummary){
  const colors={blue:"var(--blue)",purple:"var(--purple)",green:"var(--green)",amber:"var(--amber)",red:"var(--red)",teal:"var(--teal)",pink:"var(--pink)",indigo:"var(--indigo)"};
  const dot=`<span class="dot" style="background:${colors[tile.color]||'var(--blue)'}"></span>`;
  if(tile.type==="kpi"){
    const curr=summary[tile.metric]||0;
    const prev=prevSummary?(prevSummary[tile.metric]||0):0;
    const dP=ui.compare?deltaPill(curr,prev):"";
    const hint = tile.metric==="expectedIncome" ? "×¦×¤×•×™ (×××•×©×¨×•×ª + ×¤×ª×•×—×•×ª)" : (tile.metric==="actualIncome" ? "×œ×¤×™ ×ª×©×œ×•××™×" : "×‘×˜×•×•×— × ×‘×—×¨");
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge blue">KPI</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        <div class="kpiVal">${money(curr)}</div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          ${dP}
          <span class="pill ${tile.color}">${hint}</span>
        </div>
        <div class="small" style="margin-top:10px">×˜×•×•×—: ${ui.range.from}â€“${ui.range.to}</div>
      </div>
    `;
  }
  if(tile.type==="chart"){
    const ser=dailyIncomeSeries(ui.range);
    const prev=ui.compare?dailyIncomeSeries(prevRange()):null;
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge purple">×’×¨×£</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        ${renderLineChart(ser,prev)}
        <div class="small" style="margin-top:8px">×”×›× ×¡×” ×œ×¤×™ ×™×•× (×œ×¤×™ ×ª××¨×™×š ×ª×©×œ×•×).</div>
      </div>
    `;
  }
  if(tile.type==="table" && tile.table==="staff_perf"){
    const rows=staffPerfRows();
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge teal">×˜×‘×œ×”</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        <div class="tableWrap">
          <table>
            <tr><th>×¢×•×‘×“</th><th>×”×›× ×¡×”</th><th>××¡×³ ××¡××›×™×</th><th>×ª×¨×•××”</th></tr>
            ${rows.map(r=>`<tr><td style="font-weight:950">${r.name}</td><td>${money(r.income)}</td><td>${r.count}</td><td>${r.share.toFixed(1)}%</td></tr>`).join("")}
          </table>
        </div>
        <div class="small" style="margin-top:8px">×‘×”××©×š: ×¢××œ×•×ª + ×¢×œ×•×™×•×ª + ×¨×•×•×— ×œ×¤×™ ×¢×•×‘×“.</div>
      </div>
    `;
  }
  if(tile.type==="table" && tile.table==="docs_attention"){
    const docs=demo.docs.filter(d=>d.kind==="×—×©×‘×•× ×™×ª" && inRange(d.createdDate)).filter(d=>["×¤×ª×•×—×”","×‘××™×—×•×¨","×©×•×œ××” ×—×œ×§×™×ª"].includes(d.status)).slice(0,8);
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge red">×¤×¢×•×œ×•×ª</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        <div class="tableWrap">
          <table>
            <tr><th>××¡×³</th><th>×œ×§×•×—</th><th>×¡×˜×˜×•×¡</th><th>×¡×›×•×</th><th>××‘×¦×¢</th></tr>
            ${(docs.length?docs.map(d=>`<tr onclick="openDoc(${d.no})"><td>#${d.no}</td><td>${d.customerName}</td><td>${d.status}</td><td>${money(d.total)}</td><td>${d.performer}</td></tr>`).join(""):`<tr><td colspan="5" class="small">××™×Ÿ ××¡××›×™× ×¤×ª×•×—×™× ×‘×˜×•×•×—</td></tr>`)}
          </table>
        </div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" onclick="toast('×“××•: ×ª×–×›×•×¨×ª × ×©×œ×—×”', 'blue')">×©×œ×— ×ª×–×›×•×¨×ª</button>
          <button class="btn" onclick="go('docs')">×¤×ª×— ××¡××›×™×</button>
        </div>
      </div>
    `;
  }
  if(tile.type==="todo"){
    const open=getOpenTasksSorted().slice(0,7);
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge amber">Toâ€‘Do</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        <div class="small" style="margin-bottom:10px">×œ×—×¥ ×œ×¤×ª×™×—×”/×¢×“×›×•×Ÿ</div>
        <div class="tableWrap">
          <table>
            <tr><th>××©×™××”</th><th>×©×™×•×š</th><th>×¢×“×™×¤×•×ª</th><th>×©×œ×‘</th></tr>
            ${(open.length?open.map(t=>`<tr onclick="openTask('${t.id}')"><td style="font-weight:950">${t.source==="AI"?"ğŸ¤– ":""}${t.title}</td><td>${t.assignee}</td><td><span class="badge ${t.priority==="×’×‘×•×”×”"?"red":t.priority==="×‘×™× ×•× ×™×ª"?"amber":"teal"}">${t.priority}</span></td><td><span class="badge ${t.stage==="×‘×ª×”×œ×™×š"?"blue":t.stage==="×‘×•×¦×¢"?"teal":"purple"}">${t.stage}</span></td></tr>`).join(""):`<tr><td colspan="4" class="small">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª</td></tr>`)}
          </table>
        </div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" onclick="quickCreateTask()">+ ××©×™××”</button>
          <button class="btn" onclick="toggleFloatTodo()">×¤×ª×— Toâ€‘Do ×¦×£</button>
        </div>
      </div>
    `;
  }
  if(tile.type==="custom"){
    return `
      <div class="tileHead dragArea">
        <div class="t">${dot}<span>${tile.title}</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge indigo">××•×ª××</span>
          <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
        </div>
      </div>
      <div class="tileBody">
        <div class="small">×‘×œ×•×§ ××•×ª×× (×“××•): ${tile.view}</div>
        <div style="margin-top:10px" class="miniGrid">
          <div class="card" style="box-shadow:none;border-radius:16px">
            <div class="cardHead"><div class="t">×”×¢×¨×”</div><span class="badge purple">AI</span></div>
            <div class="cardBody small">×‘××•×¦×¨: ×•×•×™×“×’×³×˜ ×—×•×¤×©×™ ×œ×¤×™ ×ª×‘× ×™×•×ª + SQL/Filters.</div>
          </div>
          <div class="card" style="box-shadow:none;border-radius:16px">
            <div class="cardHead"><div class="t">×¤×¢×•×œ×”</div><span class="badge teal">Quick</span></div>
            <div class="cardBody small">×‘××•×¦×¨: ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ×œ×¤×™ ×”×¨×©××•×ª.</div>
          </div>
        </div>
      </div>
    `;
  }
  return `
    <div class="tileHead dragArea">
      <div class="t">${dot}<span>${tile.title}</span></div>
      <button class="btn icon" onclick="removeTile('${tile.id}')" title="×”×¡×¨">âœ•</button>
    </div>
    <div class="tileBody"><div class="small">×ª×•×›×Ÿ (×“××•)</div></div>
  `;
}

function removeTile(id){
  ui.dash.tiles = ui.dash.tiles.filter(t=>t.id!==id);
  toast("×•×•×™×“×’×³×˜ ×”×•×¡×¨", "amber");
  renderDashboard();
}

function renderDashboard(){
  const page=document.getElementById("page");
  const s=calcSummary(ui.range);
  const prev=ui.compare?calcSummary(prevRange()):null;

  page.innerHTML = `
    <div class="card" style="grid-column:1/-1">
      <div class="cardHead">
        <div class="t">Dashboard Builder</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <span class="pill blue">×’×¨×™×¨×” / Resize</span>
          <span class="pill purple">Add Widget</span>
          <span class="pill teal">AI Builder</span>
          <button class="btn primary" onclick="openWidgetBuilder()">ï¼‹ Add Widget</button>
          <button class="btn pink" onclick="openAIBuild()">AI Builder</button>
          <button class="btn" onclick="saveLayout()">×©××•×¨ Layout</button>
        </div>
      </div>
      <div class="cardBody">
        <div class="small">×–×” ×“××• ×©×œ ××•×¦×¨ ×××™×ª×™: ×•×•×™×“×’×³×˜×™× × ×™×ª× ×™× ×œ×”×–×–×”/×©×™× ×•×™ ×’×•×“×œ + ×ª×•×¡×¤×ª ×•×•×™×“×’×³×˜×™× ×œ×¤×™ ×ª×‘× ×™×•×ª (×›×•×œ×œ AI).</div>
        <div class="canvas" id="canvas" style="margin-top:12px">
          <div class="canvasBg"></div>
        </div>
      </div>
    </div>
  `;

  const canvas=document.getElementById("canvas");
  const maxY=Math.max(0,...ui.dash.tiles.map(t=>t.y+t.h));
  canvas.style.minHeight = (maxY*(ui.dash.rowH+ui.dash.gap) + 80) + "px";

  for(const tile of ui.dash.tiles){
    const r=tileRect(tile);
    const el=document.createElement("div");
    el.className="tile";
    el.style.left=r.left+"px"; el.style.top=r.top+"px"; el.style.width=r.width+"px"; el.style.height=r.height+"px";
    el.innerHTML = `
      ${renderTileContent(tile, s, prev)}
      <div class="handle" title="Resize"></div>
    `;
    el.querySelector(".dragArea")?.addEventListener("pointerdown",(e)=>onPointerDown(e,tile.id,"move"));
    el.querySelector(".handle")?.addEventListener("pointerdown",(e)=>onPointerDown(e,tile.id,"resize"));
    canvas.appendChild(el);
  }
}

/* Widget Builder */
const WIDGET_LIBRARY = [
  {type:"kpi", title:"KPI: ×”×›× ×¡×” ×‘×¤×•×¢×œ", color:"blue", metric:"actualIncome", w:3, h:2},
  {type:"kpi", title:"KPI: ×”×›× ×¡×” ×¦×¤×•×™×”", color:"purple", metric:"expectedIncome", w:3, h:2},
  {type:"kpi", title:"KPI: ×”×•×¦××•×ª", color:"amber", metric:"totalExpenses", w:3, h:2},
  {type:"kpi", title:"KPI: ×¨×•×•×—", color:"green", metric:"netProfit", w:3, h:2},
  {type:"chart", title:"×’×¨×£: ××’××ª ×”×›× ×¡×•×ª", color:"blue", chart:"line_income", w:7, h:4},
  {type:"table", title:"×˜×‘×œ×”: ×‘×™×¦×•×¢×™× ×œ×¤×™ ×¢×•×‘×“", color:"teal", table:"staff_perf", w:5, h:4},
  {type:"table", title:"×˜×‘×œ×”: ××¡××›×™× ×¤×ª×•×—×™×/×‘××™×—×•×¨", color:"red", table:"docs_attention", w:7, h:4},
  {type:"todo", title:"Toâ€‘Do: ××©×™××•×ª ×¤×ª×•×—×•×ª", color:"amber", w:5, h:4},
  {type:"custom", title:"Custom: ROI ×©×™×•×•×§", color:"purple", view:"marketing_roi", w:6, h:4},
  {type:"custom", title:"Custom: ××œ××™ × ××•×š", color:"amber", view:"low_stock", w:6, h:4},
];

function openWidgetBuilder(){
  const cards = WIDGET_LIBRARY.map((w,idx)=>`
    <div class="card" style="box-shadow:none">
      <div class="cardHead">
        <div class="t">${w.title}</div>
        <span class="badge ${w.color==="red"?"red":w.color==="amber"?"amber":w.color==="teal"?"teal":w.color==="purple"?"purple":"blue"}">${w.type}</span>
      </div>
      <div class="cardBody">
        <div class="small">×’×•×“×œ: ${w.w}Ã—${w.h} â€¢ ×¦×‘×¢: ${w.color}</div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" onclick="addWidget(${idx})">×”×•×¡×£ ×œ×“×©×‘×•×¨×“</button>
          <button class="btn" onclick="toast('×“××•: Preview', 'blue')">Preview</button>
        </div>
      </div>
    </div>
  `).join("");
  openModal("Widget Library", `
    <div class="cols">
      <div class="card">
        <div class="small">×‘×—×¨ ×•×•×™×“×’×³×˜ ××•×›×Ÿ (×›××• Monday Widgets). ××¤×©×¨ ×’× ×œ×™×¦×•×¨ Custom / AIâ€‘Generated.</div>
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px">
          ${cards}
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">Custom Widget</div><span class="badge indigo">PRO</span></div>
        <div class="cardBody">
          <div class="small">×‘×“××•: ××™×™×¦×¨×™× ×•×•×™×“×’×³×˜ â€œ×›×œ×œ×™â€. ×‘××•×¦×¨: ×¤×™×œ×˜×¨×™×, SQL, ×ª×‘× ×™×•×ª UI.</div>
          <textarea id="customWidgetTitle" placeholder="×›×•×ª×¨×ª ×•×•×™×“×’×³×˜ (×œ×“×•×’××”: ×œ×™×“×™× ×”×©×‘×•×¢)"></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <select id="customWidgetColor">
              <option value="blue">×›×—×•×œ</option>
              <option value="purple">×¡×’×•×œ</option>
              <option value="teal">×˜×•×¨×§×™×–</option>
              <option value="amber">×›×ª×•×</option>
              <option value="red">××“×•×</option>
            </select>
            <select id="customWidgetView">
              <option value="note">×”×¢×¨×”/×˜×§×¡×˜</option>
              <option value="table">×˜×‘×œ×”</option>
              <option value="pie">×¢×•×’×”</option>
              <option value="bar">×‘×¨</option>
            </select>
          </div>
          <button class="btn pink" style="margin-top:10px" onclick="addCustomWidget()">×¦×•×¨ ×•×”×•×¡×£</button>
          <hr style="margin:14px 0">
          <button class="btn teal" onclick="openAIBuild()">AI Builder (×”×•×¡×£ ××•×˜×•××˜×™×ª)</button>
        </div>
      </div>
    </div>
  `);
}
function addWidget(idx){
  const w=WIDGET_LIBRARY[idx];
  const id=uuid("w");
  ui.dash.tiles.push({id, ...w, x:0, y:12, w:w.w, h:w.h});
  toast("×•×•×™×“×’×³×˜ × ×•×¡×£: "+w.title, "teal");
  closeModal();
  renderDashboard();
}
function addCustomWidget(){
  const title=(document.getElementById("customWidgetTitle").value||"").trim()||"×•×•×™×“×’×³×˜ ××•×ª××";
  const color=document.getElementById("customWidgetColor").value;
  const view=document.getElementById("customWidgetView").value;
  ui.dash.tiles.push({id:uuid("cw"), type:"custom", title, color, view, x:0, y:12, w:6, h:4});
  toast("× ×•×¡×£ Custom Widget", "purple");
  closeModal();
  renderDashboard();
}
function saveLayout(){
  toast("Layout × ×©××¨ (×“××•)", "teal");
  notifications.unshift({id:uuid("n"), ts:new Date().toLocaleString("he-IL"), title:"Layout × ×©××¨", body:"×”×“×©×‘×•×¨×“ × ×©××¨ ×‘×”×’×“×¨×•×ª ×”××©×ª××©", tone:"teal"});
  setNotifDot();
}

/* AI Builder */
function openAIBuild(){
  openModal("AI Builder â€¢ ×ª××¨ ××” ×ª×¨×¦×” ×œ×¨××•×ª", `
    <div class="cols">
      <div class="card">
        <div class="small">×›×ª×•×‘ ×‘×¢×‘×¨×™×ª ×¤×©×•×˜×”. ×”×“××• ×™×¦×™×¢ ×•×•×™×“×’×³×˜×™× ×¨×œ×•×•× ×˜×™×™×. (×‘××•×¦×¨: ×™×¦×™×¨×ª Layout + Widgets + Filters)</div>
        <textarea id="ai_prompt" placeholder="×œ×“×•×’××”: ×ª×¨××” ×œ×™ ×”×•×¦××•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×” ×•×¢×•×‘×“ + ××œ××™ × ××•×š"></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn pink" onclick="aiSuggest()">×”×¦×¢</button>
          <button class="btn" onclick="closeModal()">×¡×’×•×¨</button>
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">×”×¦×¢×•×ª</div><span class="badge purple">AI</span></div>
        <div class="cardBody" id="ai_suggestions" class="small">×¢×“×™×™×Ÿ ××™×Ÿ ×”×¦×¢×•×ª.</div>
      </div>
    </div>
  `);
}
function aiSuggest(){
  const txt=(document.getElementById("ai_prompt").value||"").trim().toLowerCase();
  if(!txt) return;
  const sugg=[];
  if(txt.includes("×”×•×¦××•×ª")) sugg.push({title:"×”×•×¦××•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×” (×¢×•×’×”)", type:"custom", color:"amber", view:"pie", w:6, h:4});
  if(txt.includes("××œ××™") || txt.includes("×—×œ×¤×™×")) sugg.push({title:"××œ××™ × ××•×š", type:"custom", color:"amber", view:"low_stock", w:6, h:4});
  if(txt.includes("×¢×•×‘×“")) sugg.push({title:"×‘×™×¦×•×¢×™× ×œ×¤×™ ×¢×•×‘×“", type:"table", color:"teal", table:"staff_perf", w:5, h:4});
  if(txt.includes("××™×—×•×¨") || txt.includes("×‘××™×—×•×¨")) sugg.push({title:"××¡××›×™× ×‘××™×—×•×¨", type:"table", color:"red", table:"docs_attention", w:7, h:4});
  if(txt.includes("×”×›× ×¡×”") || txt.includes("××›×™×¨×•×ª")) sugg.push({title:"××’××ª ×”×›× ×¡×•×ª", type:"chart", color:"blue", chart:"line_income", w:7, h:4});
  if(txt.includes("××©×™××•×ª") || txt.includes("×˜×•×“×•")) sugg.push({title:"××©×™××•×ª ×¤×ª×•×—×•×ª", type:"todo", color:"amber", w:5, h:4});
  while(sugg.length<3) sugg.push({title:"Custom: KPI × ×•×¡×£", type:"custom", color:"purple", view:"kpi", w:6, h:3});
  const unique=[]; const seen=new Set();
  for(const s of sugg){ if(!seen.has(s.title)){ unique.push(s); seen.add(s.title); } if(unique.length>=3) break; }
  window.__ai_sugg=unique;
  document.getElementById("ai_suggestions").innerHTML = unique.map((s,i)=>`
    <div class="card" style="box-shadow:none;margin-bottom:10px">
      <div class="cardHead">
        <div class="t">#${i+1} ${s.title}</div>
        <button class="btn primary" onclick="aiAdd(${i})">×”×•×¡×£</button>
      </div>
      <div class="cardBody small">×¡×•×’: ${s.type} â€¢ ×’×•×“×œ: ${s.w}Ã—${s.h} â€¢ ×¦×‘×¢: ${s.color}</div>
    </div>
  `).join("");
}
function aiAdd(idx){
  const s=(window.__ai_sugg||[])[idx];
  if(!s) return;
  ui.dash.tiles.push({id:uuid("aiw"), ...s, x:0, y:12, w:s.w, h:s.h});
  toast("AI ×”×•×¡×™×£ ×•×•×™×“×’×³×˜: "+s.title, "purple");
  closeModal();
  renderDashboard();
}

/* AI Insights */
function openAI(){
  const s=calcSummary(ui.range);
  const list=aiInsights(s).map(x=>`
    <div class="card" style="box-shadow:none;margin-bottom:10px">
      <div class="cardHead">
        <div class="t">ğŸ¤– ${x.t}</div>
        <span class="badge ${x.sev==='red'?'red':x.sev==='amber'?'amber':'teal'}">${x.sev}</span>
      </div>
      <div class="cardBody">
        <div class="small">${x.d}</div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn teal" onclick="createTaskFromInsight('${x.t.replaceAll("'","\\'")}')">×¦×•×¨ ××©×™××”</button>
          <button class="btn" onclick="toast('×“××•: ×¤×¢×•×œ×” ×‘×•×¦×¢×”', 'blue')">×‘×¦×¢ ×¤×¢×•×œ×”</button>
        </div>
      </div>
    </div>
  `).join("");
  openModal("AI ×ª×•×‘× ×•×ª", list || `<div class="small">××™×Ÿ ×ª×•×‘× ×•×ª ×‘×˜×•×•×—</div>`);
}
function createTaskFromInsight(title){ ensureTask("×˜×¤×œ: "+title, {source:"AI", priority:"×‘×™× ×•× ×™×ª", assignee:"××™×¦×™×§", stage:"×¤×ª×•×—", due:ui.range.to}); closeModal(); render(); }

/* Notifications */
function openNotifications(){
  const rows = notifications.slice(0,12).map(n=>`
    <div class="card" style="box-shadow:none;margin-bottom:10px">
      <div class="cardHead">
        <div class="t">${n.title}</div>
        <span class="badge ${n.tone==='red'?'red':n.tone==='amber'?'amber':n.tone==='teal'?'teal':'blue'}">${n.ts}</span>
      </div>
      <div class="cardBody small">${n.body}</div>
    </div>
  `).join("");
  openModal("×”×ª×¨××•×ª", `
    <div class="cols">
      <div class="card">
        <div class="cardHead"><div class="t">××¨×›×– ×”×ª×¨××•×ª</div><button class="btn" onclick="clearNotifications()">× ×§×”</button></div>
        <div class="cardBody">${rows || '<div class="small">××™×Ÿ ×”×ª×¨××•×ª</div>'}</div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">×“××•</div><span class="badge purple">PRO</span></div>
        <div class="cardBody small">
          ×‘××•×¦×¨: ×”×ª×¨××•×ª ×‘×–××Ÿ ×××ª (WebSockets), ×“×—×™×¤×•×ª, ×©×§×˜, ×—×•×§×™×.<br/><br/>
          <button class="btn primary" onclick="pushDemoNotif()">×”×•×¡×£ ×”×ª×¨××” ×œ×“××•</button>
        </div>
      </div>
    </div>
  `);
  notifications = notifications; // keep
  setNotifDot(); // still on until clear
}
function clearNotifications(){
  notifications=[];
  setNotifDot();
  toast("×”×ª×¨××•×ª × ×•×§×•", "teal");
  closeModal();
}
function pushDemoNotif(){
  notifications.unshift({id:uuid("n"), ts:new Date().toLocaleString("he-IL"), title:"×“××•: ××™×¨×•×¢ ×—×“×©", body:"× ×•×¦×¨ ××¡××š ×—×“×©/×ª×•×¨ ×—×“×©/×ª×©×œ×•× ×”×ª×§×‘×œ", tone:"blue"});
  setNotifDot();
  toast("×”×ª×¨××” × ×•×¡×¤×”", "blue");
}

/* ===================== TASKS ===================== */
function refreshBadges(){
  document.getElementById("roleBadge").textContent=ui.role;
  setNotifDot();
}
function getOpenTasksSorted(){
  const pr=(p)=>({"×’×‘×•×”×”":3,"×‘×™× ×•× ×™×ª":2,"× ××•×›×”":1}[p]||2);
  return tasks.filter(t=>t.status==="×¤×ª×•×—×”")
    .sort((a,b)=>(pr(b.priority)-pr(a.priority)) || String(a.due).localeCompare(b.due));
}
function renderFloatTodo(){
  const body=document.getElementById("floatTodoBody");
  const open=getOpenTasksSorted().slice(0,10);
  body.innerHTML = open.map(t=>`
    <div class="taskRow" onclick="openTask('${t.id}')">
      <div style="flex:1">
        <div class="t">${t.source==="AI"?"ğŸ¤– ":""}${t.title}</div>
        <div class="m">${t.assignee} â€¢ ×™×¢×“: ${t.due||"â€”"}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
        <span class="badge ${t.priority==="×’×‘×•×”×”"?"red":t.priority==="×‘×™× ×•× ×™×ª"?"amber":"teal"}">${t.priority}</span>
        <span class="badge ${t.stage==="×‘×ª×”×œ×™×š"?"blue":t.stage==="×‘×•×¦×¢"?"teal":"purple"}">${t.stage}</span>
      </div>
    </div>
  `).join("") || `<div class="small">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª</div>`;
}
function toggleFloatTodo(forceClose=false){
  if(forceClose) ui.floatTodo=false;
  else ui.floatTodo=!ui.floatTodo;
  document.getElementById("floatTodo").classList.toggle("hidden", !ui.floatTodo);
  if(ui.floatTodo) renderFloatTodo();
}
function quickCreateTask(){
  const assignees = demo.users.map(u=>`<option value="${u.name}">${u.name}</option>`).join("");
  openModal("×™×¦×™×¨×ª ××©×™××”", `
    <div class="cols">
      <div class="card">
        <div class="small">×›××• Monday: ×›×•×ª×¨×ª, ×©×™×•×š, ×¢×“×™×¤×•×ª, ×©×œ×‘. (×“××•)</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
          <div style="grid-column:1 / -1">
            <div class="small">×›×•×ª×¨×ª</div>
            <input id="t_title" placeholder="×œ×“×•×’××”: ×œ×”×ª×§×©×¨ ×œ×™×•×‘×œ" />
          </div>
          <div>
            <div class="small">×©×™×•×š</div>
            <select id="t_assignee">${assignees}</select>
          </div>
          <div>
            <div class="small">×¢×“×™×¤×•×ª</div>
            <select id="t_priority"><option>× ××•×›×”</option><option selected>×‘×™× ×•× ×™×ª</option><option>×’×‘×•×”×”</option></select>
          </div>
          <div>
            <div class="small">×™×¢×“</div>
            <input id="t_due" type="date" value="${ui.range.to}"/>
          </div>
          <div>
            <div class="small">×©×œ×‘</div>
            <select id="t_stage"><option selected>×¤×ª×•×—</option><option>×‘×ª×”×œ×™×š</option><option>×‘×•×¦×¢</option></select>
          </div>
          <div style="grid-column:1 / -1">
            <div class="small">××§×•×¨</div>
            <select id="t_source"><option selected>×™×“× ×™</option><option>AI</option></select>
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn primary" onclick="saveTask()">×©××•×¨</button>
          <button class="btn" onclick="closeModal()">×‘×™×˜×•×œ</button>
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">××•×˜×•××¦×™×•×ª ××•××œ×¦×•×ª</div><span class="badge purple">AI</span></div>
        <div class="cardBody small">
          ×—×©×‘×•× ×™×ª ×‘××™×—×•×¨ â†’ ××©×™××” ×œ×× ×”×œ<br/>
          ×”×¦×¢×” ×××ª×™× ×” â†’ ×¤×•×œ×•××¤ ×œ×¢×•×‘×“<br/>
          ROI × ××•×š â†’ ×¢×¦×™×¨×ª ×§××¤×™×™×Ÿ<br/>
          ××œ××™ × ××•×š â†’ ×”×ª×¨××” ×œ×¨×›×©
          <hr style="margin:12px 0">
          <button class="btn pink" onclick="go('automations'); closeModal();">×¤×ª×— ××•×˜×•××¦×™×•×ª</button>
        </div>
      </div>
    </div>
  `);
}
function saveTask(){
  const title=(document.getElementById("t_title").value||"").trim();
  if(!title) return toast("×—×™×™×‘×™× ×›×•×ª×¨×ª ×œ××©×™××”", "red");
  tasks.unshift({id:uuid("t"), title, priority:document.getElementById("t_priority").value, status:"×¤×ª×•×—×”", stage:document.getElementById("t_stage").value, assignee:document.getElementById("t_assignee").value, due:document.getElementById("t_due").value, source:document.getElementById("t_source").value});
  toast("××©×™××” × ×©××¨×”", "teal");
  renderFloatTodo(); closeModal(); render();
}
function openTask(id){
  const t=tasks.find(x=>x.id===id); if(!t) return;
  openModal("××©×™××”", `
    <div class="card">
      <div class="cardHead">
        <div class="t">${t.source==="AI"?"ğŸ¤– ":""}${t.title}</div>
        <span class="badge ${t.priority==="×’×‘×•×”×”"?"red":t.priority==="×‘×™× ×•× ×™×ª"?"amber":"teal"}">${t.priority}</span>
      </div>
      <div class="cardBody">
        <div class="small">×©×™×•×š: <b>${t.assignee}</b> â€¢ ×™×¢×“: <b>${t.due||"â€”"}</b> â€¢ ××§×•×¨: <b>${t.source}</b></div>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn teal" onclick="moveTask('${t.id}','×‘×•×¦×¢')">×¡××Ÿ ×‘×•×¦×¢</button>
          <button class="btn" onclick="moveTask('${t.id}','×‘×ª×”×œ×™×š')">×”×¢×‘×¨ ×œ×‘×ª×”×œ×™×š</button>
          <button class="btn" onclick="moveTask('${t.id}','×¤×ª×•×—')">×”×¢×‘×¨ ×œ×¤×ª×•×—</button>
          <button class="btn primary" onclick="go('tasks'); closeModal();">×¤×ª×— Board</button>
        </div>
      </div>
    </div>
  `);
}
function moveTask(id, stage){
  const t=tasks.find(x=>x.id===id); if(!t) return;
  t.stage=stage;
  if(stage==="×‘×•×¦×¢") t.status="×‘×•×¦×¢"; else t.status="×¤×ª×•×—×”";
  toast("×¢×•×“×›×Ÿ ×©×œ×‘ ××©×™××”", "teal");
  renderFloatTodo(); closeModal(); render();
}

/* ===================== PAGES ===================== */
function openCustomer(no){
  const c=demo.customers.find(x=>x.no===no)||demo.customers.find(x=>String(x.no)===String(no));
  if(!c) return;
  openModal("×œ×§×•×—", `
    <div class="cols">
      <div class="card">
        <div class="cardHead"><div class="t">${c.name}</div><span class="badge blue">#${c.no}</span></div>
        <div class="cardBody small">
          ×˜×œ×¤×•×Ÿ: ${c.phone}<br/>
          ××™××™×™×œ: ${c.email}<br/>
          ×›×ª×•×‘×ª: ${c.address}<br/>
          <hr style="margin:12px 0">
          ××—×¨×™ ×©××™×¨×ª ×œ×§×•×— (×›××• ×©×‘×™×§×©×ª):<br/>
          <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn purple" onclick="toast('×“××•: ×”×¦×¢×ª ××—×™×¨ × ×•×¦×¨×”', 'purple')">×©×œ×— ×”×¦×¢×ª ××—×™×¨</button>
            <button class="btn primary" onclick="toast('×“××•: ×—×©×‘×•× ×™×ª × ×•×¦×¨×”', 'blue')">×”×•×¦× ×—×©×‘×•× ×™×ª</button>
            <button class="btn" onclick="closeModal()">×—×–×•×¨ ×œ×¨×©×™××”</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">×”×¢×¨×•×ª AI</div><span class="badge purple">AI</span></div>
        <div class="cardBody small">
          ×‘××•×¦×¨: AI ××¡×›× ×©×™×—×•×ª/××™×™×œ×™× ×¢× ×”×œ×§×•×—, ××¦×™×¢ ×¤×•×œ×•××¤×™× ×•××¡×•×•×’ ×œ×™×“×™×.
          <hr style="margin:12px 0">
          <button class="btn teal" onclick="ensureTask('×¤×•×œ×•××¤ ×œ×œ×§×•×—: ${c.name}', {source:'AI', priority:'×‘×™× ×•× ×™×ª', assignee:'××™×›×œ', stage:'×¤×ª×•×—', due:ui.range.to}); closeModal();">×¦×•×¨ ××©×™××ª ×¤×•×œ×•××¤</button>
        </div>
      </div>
    </div>
  `);
}
function openDoc(no){ openModal("××¡××š", `<div class="small">×¤×ª×™×—×ª ××¡××š #${no} (×“××•). ×‘××•×¦×¨: ×ª×¦×•×’×” ××œ××” + ×¢×¨×™×›×” + ×¡×˜×˜×•×¡×™× + ×”×™×¡×˜×•×¨×™×”.</div>`); }
function openAppt(a){ openModal("×ª×•×¨", `<div class="small"><b>${a.customerName}</b><br/>×ª××¨×™×š: ${a.date} ${a.time}<br/>×©×™×¨×•×ª: ${a.service}<br/>×¢×•×‘×“: ${a.staff}<br/>×¡×˜×˜×•×¡: ${a.status}</div>`); }

function renderCustomers(){
  const q=(document.getElementById("globalSearch").value||"").trim();
  const rows=demo.customers.filter(c=>!q||String(c.no).includes(q)||c.name.includes(q)||c.phone.includes(q)||c.email.includes(q)).slice(0,60)
    .map(c=>`<tr onclick="openCustomer(${c.no})"><td>${c.no}</td><td style="font-weight:950">${c.name}</td><td>${c.phone}</td><td>${c.email}</td><td>${c.address}</td></tr>`).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×œ×§×•×—×•×ª</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="openModal('×”×•×¡×¤×ª ×œ×§×•×—','×‘×“××•: ×˜×•×¤×¡. ×‘××•×¦×¨: ×œ××—×¨ ×©××™×¨×” ×§×•×¤×¥ ××¡×š ×¤×¢×•×œ×•×ª (×”×¦×¢×ª ××—×™×¨ / ×—×©×‘×•× ×™×ª).')">+ ×”×•×¡×¤×ª ×œ×§×•×—</button>
            <button class="btn" onclick="toast('×“××•: ×™×™×‘×•× CSV', 'blue')">×™×™×‘×•× CSV</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">××¡×³ ×œ×§×•×— ×¨×¥ (×¡×¤×¨×•×ª ×‘×œ×‘×“) + ××™××™×™×œ + ×›×ª×•×‘×ª. ×œ×—×™×¦×” ×¢×œ ×œ×§×•×— â†’ ×¤×¢×•×œ×•×ª.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>××¡×³</th><th>×©×</th><th>×˜×œ×¤×•×Ÿ</th><th>××™××™×™×œ</th><th>×›×ª×•×‘×ª</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderDocs(){
  const q=(document.getElementById("globalSearch").value||"").trim();
  const docs=demo.docs.filter(d=>inRange(d.createdDate)).filter(d=>!q||String(d.no).includes(q)||d.customerName.includes(q)||String(d.customerNo).includes(q)).sort((a,b)=>b.no-a.no).slice(0,30);
  const rows=docs.map(d=>`
    <tr onclick="openDoc(${d.no})">
      <td>${d.kind}</td><td>#${d.no}</td>
      <td>${d.customerName} <span class="small">(#${d.customerNo})</span></td>
      <td>${d.status}</td>
      <td>${money(d.total)}</td>
      <td><span class="pill teal">${d.performer}</span></td>
    </tr>
  `).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">××¡××›×™×</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn purple" onclick="toast('×“××•: ×™×¦×™×¨×ª ×”×¦×¢×ª ××—×™×¨', 'purple')">+ ×”×¦×¢×ª ××—×™×¨</button>
            <button class="btn primary" onclick="toast('×“××•: ×™×¦×™×¨×ª ×—×©×‘×•× ×™×ª', 'blue')">+ ×—×©×‘×•× ×™×ª</button>
            <button class="btn" onclick="toast('×“××•: ×¡×™× ×•×Ÿ ××ª×§×“×', 'blue')">×¡×™× ×•×Ÿ ××ª×§×“×</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">×¡×˜×˜×•×¡×™×: ×¤×ª×•×—/×‘××™×—×•×¨/×©×•×œ×/×××ª×™×Ÿ ×œ××™×©×•×¨/×‘×•×˜×œ. ×›×•×œ×œ â€œ××‘×¦×¢ ×¢×‘×•×“×”â€.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×¡×•×’</th><th>××¡×³</th><th>×œ×§×•×—</th><th>×¡×˜×˜×•×¡</th><th>×¡×›×•×</th><th>××‘×¦×¢</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderCalendar(){
  const ap=demo.appts.filter(a=>inRange(a.date)).sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time)).slice(0,28);
  const rows=ap.map(a=>`<tr><td>${a.date}</td><td>${a.time}</td><td>${a.customerName}</td><td>${a.service}</td><td>${a.staff}</td><td>${a.status}</td></tr>`).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×™×•××Ÿ ×ª×•×¨×™×</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="toast('×“××•: ×ª×•×¨ × ×§×‘×¢', 'teal')">+ ×§×‘×¢ ×ª×•×¨</button>
            <button class="btn" onclick="toast('×“××•: ×¡× ×›×¨×•×Ÿ ×’×•×’×œ ×§×œ× ×“×¨', 'blue')">×¡× ×›×¨×•×Ÿ Google Calendar</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">×©×œ×‘ ××ª×§×“×: ×œ×œ×§×•×— ×§×¦×” ×ª×”×™×” ××¤×œ×™×§×¦×™×” ×œ×§×‘×™×¢×ª ×ª×•×¨ â†’ ×”×¤×¨×˜×™× ×™×™×›× ×¡×• ××•×˜×•××˜×™×ª.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×ª××¨×™×š</th><th>×©×¢×”</th><th>×œ×§×•×—</th><th>×©×™×¨×•×ª</th><th>×¢×•×‘×“</th><th>×¡×˜×˜×•×¡</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderTasks(){
  const q=(document.getElementById("globalSearch").value||"").trim().toLowerCase();
  const filtered = tasks.filter(t=>!q || (t.title+t.assignee+t.priority+t.stage).toLowerCase().includes(q));
  const stages=["×¤×ª×•×—","×‘×ª×”×œ×™×š","×‘×•×¦×¢"];
  const col = (st)=>`
    <div class="card" style="grid-column:span 4;min-height:260px">
      <div class="cardHead">
        <div class="t">${st}</div>
        <span class="badge ${st==="×‘×•×¦×¢"?"teal":st==="×‘×ª×”×œ×™×š"?"blue":"purple"}">${filtered.filter(t=>t.stage===st).length}</span>
      </div>
      <div class="cardBody">
        ${(filtered.filter(t=>t.stage===st).map(t=>`
          <div class="card" style="box-shadow:none;margin-bottom:10px;border-radius:16px">
            <div class="cardHead">
              <div class="t" style="font-size:13px">${t.source==="AI"?"ğŸ¤– ":""}${t.title}</div>
              <span class="badge ${t.priority==="×’×‘×•×”×”"?"red":t.priority==="×‘×™× ×•× ×™×ª"?"amber":"teal"}">${t.priority}</span>
            </div>
            <div class="cardBody small">
              ${t.assignee} â€¢ ×™×¢×“: ${t.due||"â€”"}
              <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" onclick="openTask('${t.id}')">×¤×ª×—</button>
                <button class="btn teal" onclick="moveTask('${t.id}','×‘×•×¦×¢')">×‘×•×¦×¢</button>
              </div>
            </div>
          </div>
        `).join("") || `<div class="small">××™×Ÿ ××©×™××•×ª</div>`)}
      </div>
    </div>
  `;
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">××©×™××•×ª (Board)</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="quickCreateTask()">+ ××©×™××”</button>
            <button class="btn pink" onclick="runAuto(); render()">×”×¨×¥ ××•×˜×•××¦×™×•×ª</button>
          </div>
        </div>
        <div class="cardBody small">×‘×“××•: Board ×›××• Monday (×‘××•×¦×¨: Drag&Drop ××œ× ×‘×™×Ÿ ×¢××•×“×•×ª).</div>
      </div>
      ${stages.map(col).join("")}
    </div>
  `;
}

function renderExpenses(){
  const ex=demo.expenses.filter(e=>inRange(e.date)).sort((a,b)=>b.date.localeCompare(a.date)).slice(0,32);
  const rows=ex.map(e=>`<tr><td>${e.date}</td><td>${e.category}</td><td>${money(e.amount)}</td><td>${e.source}</td><td>${e.staff||"×›×œ×œ×™×ª"}</td></tr>`).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×”×•×¦××•×ª</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="toast('×“××•: ×”×•×¦××” × ×•×¡×¤×”', 'amber')">+ ×”×•×¡×£ ×”×•×¦××”</button>
            <button class="btn" onclick="toast('×“××•: ×”×¢×œ××ª ×§×‘×œ×”', 'blue')">×”×¢×œ×” ×§×‘×œ×”</button>
            <button class="btn" onclick="toast('×“××•: ×§×˜×’×•×¨×™×•×ª ××•×ª×××•×ª', 'blue')">×§×˜×’×•×¨×™×•×ª</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">×›×•×œ×œ ××™× ×˜×’×¨×¦×™×” ×¢×ª×™×“×™×ª ×œâ€‘Google Ads/Meta ×›×”×•×¦××” ××•×˜×•××˜×™×ª.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×ª××¨×™×š</th><th>×§×˜×’×•×¨×™×”</th><th>×¡×›×•×</th><th>××§×•×¨</th><th>×©×™×•×š</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderInventory(){
  const rows=inventory.map(i=>`<tr><td>${i.sku}</td><td style="font-weight:950">${i.name}</td><td>${i.qty}</td><td>${i.unit}</td><td>${money(i.cost)}</td><td>${money(i.cost*i.qty)}</td></tr>`).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">××œ××™</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="toast('×“××•: ×¤×¨×™×˜ × ×•×¡×£', 'teal')">+ ×¤×¨×™×˜</button>
            <button class="btn" onclick="toast('×“××•: ×§×™×©×•×¨ ×œ×”×•×¦××•×ª', 'blue')">×§×™×©×•×¨ ×œ×”×•×¦××•×ª</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">××œ××™ ×›×œ×œ×™ ×©××ª××™× ×œ×›×œ ×¢×¡×§ (××¡×¢×“×”/××•×¡×š/××¡×¤×¨×”). ×‘×”××©×š: × ×™×›×•×™ ××•×˜×•××˜×™ ×‘××¡××š.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>SKU</th><th>×©×</th><th>×›××•×ª</th><th>×™×—×™×“×”</th><th>×¢×œ×•×ª ×™×—×³</th><th>×©×•×•×™ ××œ××™</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderMarketing(){
  const rows=marketing.filter(m=>inRange(m.date)).map(m=>{
    const roi = m.spend>0 ? (m.revenue/m.spend) : 0;
    const tone = roi<1 ? "red" : roi<1.5 ? "amber" : "teal";
    return `<tr><td>${m.date}</td><td>${m.channel}</td><td>${money(m.spend)}</td><td>${m.leads}</td><td>${money(m.revenue)}</td><td><span class="badge ${tone}">${roi.toFixed(1)}Ã—</span></td></tr>`;
  }).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×©×™×•×•×§ (Google Ads / Meta)</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="toast('×“××•: ×—×™×‘×•×¨ Google Ads', 'blue')">×—×‘×¨ Google Ads</button>
            <button class="btn" onclick="toast('×“××•: ×—×™×‘×•×¨ Meta', 'blue')">×—×‘×¨ Meta</button>
            <button class="btn pink" onclick="openAI()">AI ×ª×•×‘× ×•×ª ROI</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">×”×™×¢×“: ×œ×”×›× ×™×¡ ×”×•×¦××•×ª ×¤×¨×¡×•× ××•×˜×•××˜×™×ª ×œ×”×•×¦××•×ª + ×œ×¨××•×ª ROI ×•×ª×•×¦××•×ª.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×ª××¨×™×š</th><th>×¢×¨×•×¥</th><th>×”×•×¦××”</th><th>×œ×™×“×™×</th><th>×”×›× ×¡×” ××™×•×—×¡×ª</th><th>ROI</th></tr>
              ${rows || `<tr><td colspan="6" class="small">××™×Ÿ × ×ª×•× ×™× ×‘×˜×•×•×—</td></tr>`}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderCommunications(){
  const rows=comms.map(c=>`<tr><td>${c.ts}</td><td>${c.type}</td><td>${c.from}</td><td>${c.summary}</td><td><span class="badge ${c.sentiment==="×—×™×•×‘×™"?"teal":c.sentiment==="× ×™×˜×¨×œ×™"?"blue":"red"}">${c.sentiment}</span></td></tr>`).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×©×™×—×•×ª / ××™×™×œ×™× (× ×™×ª×•×— AI)</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="toast('×“××•: ×—×™×‘×•×¨ ××§×•×¨ ×©×™×—×•×ª', 'blue')">×—×‘×¨ Call Source</button>
            <button class="btn" onclick="toast('×“××•: ×—×™×‘×•×¨ Gmail/Outlook', 'blue')">×—×‘×¨ ××™×™×œ</button>
            <button class="btn pink" onclick="toast('×“××•: × ×™×ª×•×— ×©×™×—×”', 'purple')">× ×ª×— ×©×™×—×”</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">×‘××•×¦×¨: ×”×§×œ×˜×”/×ª××œ×•×œ/×¡×™×›×•×/××©×™××•×ª ××•×˜×•××˜×™×•×ª/×¡× ×˜×™×× ×˜.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×–××Ÿ</th><th>×¡×•×’</th><th>×××ª</th><th>×¡×™×›×•×</th><th>×¡× ×˜×™×× ×˜</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderAutomations(){
  const rows=automations.map(a=>`
    <tr>
      <td style="font-weight:950">${a.name}</td>
      <td class="small">${a.if} â†’ ${a.then}</td>
      <td><span class="badge ${a.severity==="×’×‘×•×”×”"?"red":"amber"}">${a.severity}</span></td>
      <td><button class="btn ${a.enabled?"teal":"ghost"}" onclick="toggleAutomation('${a.id}')">${a.enabled?"×¤×¢×™×œ":"×›×‘×•×™"}</button></td>
    </tr>
  `).join("");
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">××•×˜×•××¦×™×•×ª (IF/THEN)</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="runAuto(); render()">×”×¨×¥ ×¢×›×©×™×•</button>
            <button class="btn pink" onclick="openModal('×™×¦×™×¨×ª ××•×˜×•××¦×™×”','×‘×“××•: Builder. ×‘××•×¦×¨: ×ª× ××™× + ×¤×¢×•×œ×•×ª + ×œ×•×’.')">+ ××•×˜×•××¦×™×”</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="small">V1: ×—×•×§×™× ×‘×¡×™×¡×™×™×. V2: Builder ××œ× + ××™× ×˜×’×¨×¦×™×•×ª.</div>
          <div class="tableWrap" style="margin-top:12px">
            <table>
              <tr><th>×©×</th><th>×ª× ××™â†’×¤×¢×•×œ×”</th><th>×—×•××¨×”</th><th>×¡×˜×˜×•×¡</th></tr>
              ${rows}
            </table>
          </div>
        </div>
      </div>
    </div>
  `;
}
function toggleAutomation(id){
  const a=automations.find(x=>x.id===id); if(!a) return;
  a.enabled=!a.enabled;
  toast((a.enabled?"×”×•×¤×¢×œ×”":"×›×•×‘×ª×”")+" ××•×˜×•××¦×™×”", a.enabled?"teal":"amber");
  render();
}

function renderReports(){
  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card" style="grid-column:1/-1">
        <div class="cardHead">
          <div class="t">×“×•×—×•×ª</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="openWidgetBuilder()">×‘× ×” ×“×•×— (Widgets)</button>
            <button class="btn pink" onclick="openAIBuild()">AI ×‘×•× ×” ×“×•×—</button>
          </div>
        </div>
        <div class="cardBody small">
          ×‘×“××•: ×”×“×©×‘×•×¨×“ ×”×•× â€œ×“×•×— ×—×™â€. ×‘××•×¦×¨: ×™×¦×•× PDF/Excel, ×ª×‘× ×™×•×ª ×“×•×—, ×”×¨×©××•×ª ×œ×¤×™ ×ª×¤×§×™×“.
        </div>
      </div>
    </div>
  `;
}

/* Settings: Screen Config */
function openSettings(){
  const rows = NAV_ITEMS.map(n=>{
    const allowed = canAccess(n.id);
    const checked = ui.screenConfig.show[n.key] ? "checked" : "";
    return `
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px;border:1px solid var(--line);border-radius:16px;background:#fff;margin-bottom:8px;opacity:${allowed?1:0.5}">
        <div>
          <div style="font-weight:950">${n.label}</div>
          <div class="small">${n.tag} â€¢ key: ${n.key}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <label class="small">×”×¦×’</label>
          <input type="checkbox" ${checked} ${allowed?"":"disabled"} onchange="toggleModule('${n.key}', this.checked)"/>
        </div>
      </div>
    `;
  }).join("");
  openModal("×”×’×“×¨×•×ª â€¢ ×¢×™×¦×•×‘ ××¡×›×™×", `
    <div class="cols">
      <div class="card">
        <div class="cardHead"><div class="t">Screen Designer</div><span class="badge indigo">PRO</span></div>
        <div class="cardBody">
          <div class="small">×‘×¢×œ ×”×¢×¡×§ ×™×›×•×œ ×œ×‘×—×•×¨ ××™×œ×• ××¡×›×™× ××•×¤×™×¢×™×. (×›××• ×©×‘×™×§×©×ª: ×œ×›×œ ××¡×š ××¤×©×¨ ×¢×™×¦×•×‘ × ×¤×¨×“ â€” ×‘×“××•: Show/Hide)</div>
          <div style="margin-top:12px">${rows}</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <button class="btn primary" onclick="toast('× ×©××¨ (×“××•)', 'teal')">×©××•×¨</button>
            <button class="btn" onclick="closeModal()">×¡×’×•×¨</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">×ª×¤×§×™×“×™×</div><span class="badge blue">RBAC</span></div>
        <div class="cardBody small">
          ×‘×“××• ××¤×©×¨ ×œ×”×—×œ×™×£ ×ª×¤×§×™×“ ×›×“×™ ×œ×¨××•×ª ×”×’×‘×œ×•×ª:<br/><br/>
          <button class="btn full" onclick="setRole('Owner')">Owner <span class="badge blue">××œ×</span></button>
          <button class="btn full" onclick="setRole('Manager')">Manager <span class="badge teal">×›××¢×˜ ××œ×</span></button>
          <button class="btn full" onclick="setRole('Employee')">Employee <span class="badge amber">××•×’×‘×œ</span></button>
          <hr style="margin:12px 0">
          ×¢×•×‘×“ ×™×›×•×œ: ×œ×™×¦×•×¨ ×”×¦×¢×ª ××—×™×¨/×—×©×‘×•× ×™×ª, ×œ×’×‘×•×ª ×ª×©×œ×•×, ×œ×¨××•×ª ×“×•×—×•×ª ×©×œ ×¢×¦××• (×‘×”××©×š).<br/>
          ×× ×”×œ/×‘×¢×œ×™×: ×”×›×œ + Builder + ××•×˜×•××¦×™×•×ª + ×“×•×—×•×ª.
        </div>
      </div>
    </div>
  `);
}
function toggleModule(key, val){ ui.screenConfig.show[key]=val; toast("×¢×•×“×›×Ÿ ××¡×š: "+key, "blue"); renderNav(); render(); }

/* Workspace/Board management modals (demo) */
function openWorkspaceModal(){
  openModal("Workspace ×—×“×©", `
    <div class="cols">
      <div class="card">
        <div class="cardHead"><div class="t">×”×•×¡×¤×ª Workspace</div><span class="badge purple">PRO</span></div>
        <div class="cardBody">
          <div class="small">×‘×“××•: ×™×¦×™×¨×” ××§×•××™×ª. ×‘××•×¦×¨: ××•×œ×˜×™×˜× × ×˜ ×××™×ª×™.</div>
          <input id="wsName" placeholder="×©× Workspace (×œ×“×•×’××”: ××™×¦×™×§ â€¢ ×¦×¤×•×Ÿ)" />
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="btn primary" onclick="createWorkspace()">×¦×•×¨</button>
            <button class="btn" onclick="closeModal()">×‘×™×˜×•×œ</button>
          </div>
        </div>
      </div>
      <div class="card"><div class="cardHead"><div class="t">×˜×™×¤</div></div>
        <div class="cardBody small">×œâ€‘Exit: Workspaces/Boards ××™×™×¦×¨×™× â€œ×”×“×‘×§×”â€ ×•â€‘LTV ×’×‘×•×” ×™×•×ª×¨.</div>
      </div>
    </div>
  `);
}
function createWorkspace(){
  const name=(document.getElementById("wsName").value||"").trim();
  if(!name) return toast("×—×™×™×‘×™× ×©×", "red");
  const id=uuid("w");
  workspaces.unshift({id, name, tenantId:1, boards:[{id:uuid("b"), name:"CRM ×—×“×©", preset:"generic", icon:"ğŸ§©"}]});
  ui.workspaceId=id;
  initWorkspaceSelect();
  switchWorkspace(id);
  closeModal();
}
function openBoardModal(){
  openModal("Board ×—×“×©", `
    <div class="cols">
      <div class="card">
        <div class="cardHead"><div class="t">×”×•×¡×¤×ª Board</div><span class="badge purple">PRO</span></div>
        <div class="cardBody">
          <input id="bName" placeholder="×©× Board (×œ×“×•×’××”: CRM ×›×œ×œ×™)" />
          <select id="bPreset" style="margin-top:10px;width:100%">
            <option value="generic">Generic</option>
            <option value="salon">Salon</option>
            <option value="garage">Garage</option>
            <option value="restaurant">Restaurant</option>
            <option value="studio">Studio</option>
            <option value="marketing">Marketing</option>
          </select>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
            <button class="btn primary" onclick="createBoard()">×¦×•×¨</button>
            <button class="btn" onclick="closeModal()">×‘×™×˜×•×œ</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="cardHead"><div class="t">××” ×–×” Preset?</div></div>
        <div class="cardBody small">Preset ××›×™×Ÿ ××¡×›×™×/×©×“×•×ª/×ª×‘× ×™×•×ª. ×‘×”××©×š: AI ×‘×•× ×” ××ª ×–×” ××•×˜×•××˜×™×ª ×œ×¤×™ ×”×¢×¡×§.</div>
      </div>
    </div>
  `);
}
function createBoard(){
  const name=(document.getElementById("bName").value||"").trim()||"Board ×—×“×©";
  const preset=document.getElementById("bPreset").value;
  const w=currentWorkspace();
  const b={id:uuid("b"), name, preset, icon:"ğŸ§©"};
  w.boards.unshift(b);
  ui.boardId=b.id;
  renderBoards();
  closeModal();
  toast("Board × ×•×¡×£: "+name, "purple");
  go("dashboard");
}

/* Apply range */
function applyRange(){ ui.range.from=document.getElementById("fromDate").value; ui.range.to=document.getElementById("toDate").value; runAuto(); render(); }
function toggleCompare(){ ui.compare=!ui.compare; render(); }

/* ===================== ROUTER / RENDER ===================== */
function renderNav(){
  const nav=document.getElementById("nav");
  nav.innerHTML = NAV_ITEMS
    .filter(n=>ui.screenConfig.show[n.key])
    .filter(n=>canAccess(n.id))
    .map(n=>{
      const active = ui.page===n.id ? "active" : "";
      return `<button class="btn navItem ${active}" onclick="go('${n.id}')">
        <span>${n.label}</span>
        <span class="badge blue">${n.tag}</span>
      </button>`;
    }).join("") + `
      <hr style="margin:10px 0">
      <button class="btn full" onclick="openSettings()">×”×’×“×¨×•×ª ×¢×™×¦×•×‘ ××¡×›×™× <span class="badge indigo">PRO</span></button>
    `;
}
function setActiveTitle(){ 
  const map={dashboard:"×“×©×‘×•×¨×“",customers:"×œ×§×•×—×•×ª",docs:"××¡××›×™×",calendar:"×™×•××Ÿ ×ª×•×¨×™×",tasks:"××©×™××•×ª",expenses:"×”×•×¦××•×ª",inventory:"××œ××™",marketing:"×©×™×•×•×§",communications:"×©×™×—×•×ª/××™×™×œ×™×",automations:"××•×˜×•××¦×™×•×ª",reports:"×“×•×—×•×ª"};
  document.getElementById("pageTitle").innerText = map[ui.page] || "×“×©×‘×•×¨×“";
}
function go(page){
  ui.page=page;
  document.body.classList.remove("nav-open");
  render();
}

function render(){
  setActiveTitle();
  refreshBadges();
  renderNav();
  renderBoards();
  initWorkspaceSelect();
  document.getElementById("workspaceSelect").value = ui.workspaceId;
  const w=currentWorkspace();
  const tenant=demo.tenants.find(t=>t.id===w.tenantId)||demo.tenants[0];
  document.getElementById("tenantTitle").innerText = tenant.name;
  const b=currentBoard();
  document.getElementById("contextLine").innerText = `Workspace: ${w.name} â€¢ Board: ${b.name} â€¢ ×ª×¤×§×™×“: ${ui.role}`;

  // Router
  if(ui.page==="dashboard") renderDashboard();
  else if(ui.page==="customers") renderCustomers();
  else if(ui.page==="docs") renderDocs();
  else if(ui.page==="calendar") renderCalendar();
  else if(ui.page==="tasks") renderTasks();
  else if(ui.page==="expenses") renderExpenses();
  else if(ui.page==="inventory") renderInventory();
  else if(ui.page==="marketing") renderMarketing();
  else if(ui.page==="communications") renderCommunications();
  else if(ui.page==="automations") renderAutomations();
  else if(ui.page==="reports") renderReports();
  renderFloatTodo();
  document.getElementById("floatTodo").classList.toggle("hidden", !ui.floatTodo);
}
window.addEventListener("resize", ()=>{ if(ui.page==="dashboard") renderDashboard(); });

/* First load */
runAuto();
render();
toast("Level 7 PRO × ×˜×¢×Ÿ â€¢ × ×¡×” Add Widget / AI Builder / âŒ˜K", "blue");
</script>
<script src="./data-store.js"></script>
<script src="./ai-engine.js"></script>
<script src="./ai-ui.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("btnResetData");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const ok = confirm("×œ××—×•×§ ××ª ×›×œ ×”× ×ª×•× ×™×? (×œ×§×•×—×•×ª/××¡××›×™×/×”×•×¦××•×ª/××©×™××•×ª)");
      if (!ok) return;

      // ××•×—×§ × ×ª×•× ×™×, ××©××™×¨ ×”×™×¡×˜×•×¨×™×” (Audit) ×›×¨×’×¢
      DataStore.resetData({ wipeAudit: false });

      alert("× ××—×§ âœ… ×¨×¢× ×•×Ÿâ€¦");
      location.reload();
    });
  });
  </script>
</body>
</html>
